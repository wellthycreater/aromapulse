<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>아로마펄스 관리자 대시보드</title>
    <link rel="icon" type="image/png" href="/static/favicon.png">
    
    <script>
        // 페이지 로드 전 즉시 토큰 확인 (무한 리다이렉트 방지)
        console.log('=== Admin Dashboard Pre-Auth Check ===');
        const token = localStorage.getItem('adminToken') || 
                      localStorage.getItem('admin_token') || 
                      localStorage.getItem('auth_token') || 
                      localStorage.getItem('token');
        console.log('Token exists:', !!token);
        console.log('Token value:', token ? token.substring(0, 20) + '...' : 'null');
        
        if (!token) {
            console.log('No token found, redirecting to login...');
            alert('로그인이 필요합니다.');
            window.location.replace('/admin-login');
            // Prevent page from loading
            document.documentElement.innerHTML = '<body style="margin:0;padding:20px;font-family:sans-serif;">Redirecting to login...</body>';
            throw new Error('No auth token');
        } else {
            console.log('Token found, proceeding to load dashboard');
        }
    </script>
    
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <style>
        /* Custom Colors - Sage Green + Lavender Theme */
        :root {
            --sage-green: #7AA992;
            --lavender: #BCA6E0;
            --cream: #F3EDEA;
            --dark-slate: #263238;
            --medium-gray: #55606A;
            --light-gray: #E6ECEB;
        }
        
        /* Utility Classes */
        .bg-sage { background-color: var(--sage-green); }
        .bg-lavender { background-color: var(--lavender); }
        .bg-cream { background-color: var(--cream); }
        .text-sage { color: var(--sage-green); }
        .text-lavender { color: var(--lavender); }
        .border-sage { border-color: var(--sage-green); }
        .hover\:bg-sage:hover { background-color: var(--sage-green); }
        .hover\:bg-lavender:hover { background-color: var(--lavender); }
        
        /* Tab Styling */
        .tab-button {
            transition: all 0.3s ease;
            position: relative;
        }
        .tab-button.active {
            background-color: var(--sage-green);
            color: white;
        }
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background-color: var(--sage-green);
        }
        
        /* Sub-tab Styling */
        .sub-tab-button {
            transition: all 0.3s ease;
        }
        .sub-tab-button.active {
            background-color: var(--lavender);
            color: white;
        }
        
        /* Animations */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--light-gray);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--sage-green);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6A9882;
        }
        
        /* Modal Backdrop */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        
        /* Card Hover Effect */
        .hover-lift {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }
        
        /* Status Badge */
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .status-active {
            background-color: #DEF7EC;
            color: #03543F;
        }
        
        .status-inactive {
            background-color: #FDE8E8;
            color: #9B1C1C;
        }
    </style>
</head>
<body class="bg-cream min-h-screen">
    
    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <img src="/static/logo-light.png" alt="아로마펄스" class="h-12">
                    <div>
                        <h1 class="text-2xl font-bold text-sage">
                            <i class="fas fa-spa mr-2"></i>
                            관리자 대시보드
                        </h1>
                        <p class="text-xs text-gray-500 mt-1">AromaPulse Admin Dashboard</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-sm text-gray-600">
                        <i class="fas fa-user-shield mr-1"></i>
                        <span id="admin-name">관리자</span>
                    </div>
                    <button onclick="logout()" class="text-red-600 hover:text-red-700 transition font-semibold">
                        <i class="fas fa-sign-out-alt mr-2"></i>로그아웃
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Navigation Tabs -->
    <div class="bg-white border-b shadow-sm">
        <div class="container mx-auto px-6">
            <div class="flex space-x-1 overflow-x-auto">
                <button onclick="switchMainTab('dashboard')" 
                    class="tab-button px-6 py-4 font-semibold whitespace-nowrap hover:bg-gray-100 active" 
                    data-tab="dashboard">
                    <i class="fas fa-chart-line mr-2"></i>대시보드
                </button>
                <button onclick="switchMainTab('users')" 
                    class="tab-button px-6 py-4 font-semibold whitespace-nowrap hover:bg-gray-100" 
                    data-tab="users">
                    <i class="fas fa-users mr-2"></i>회원 관리
                </button>
                <button onclick="switchMainTab('products')" 
                    class="tab-button px-6 py-4 font-semibold whitespace-nowrap hover:bg-gray-100" 
                    data-tab="products">
                    <i class="fas fa-box mr-2"></i>제품 관리
                </button>
                <button onclick="switchMainTab('blog')" 
                    class="tab-button px-6 py-4 font-semibold whitespace-nowrap hover:bg-gray-100" 
                    data-tab="blog">
                    <i class="fas fa-blog mr-2"></i>블로그 관리
                </button>
                <button onclick="switchMainTab('workshops')" 
                    class="tab-button px-6 py-4 font-semibold whitespace-nowrap hover:bg-gray-100" 
                    data-tab="workshops">
                    <i class="fas fa-hands-helping mr-2"></i>워크샵 관리
                </button>
                <button onclick="switchMainTab('classes')" 
                    class="tab-button px-6 py-4 font-semibold whitespace-nowrap hover:bg-gray-100" 
                    data-tab="classes">
                    <i class="fas fa-chalkboard-teacher mr-2"></i>원데이 클래스
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="container mx-auto px-6 py-8">
        
        <!-- Dashboard Section -->
        <div id="section-dashboard" class="content-section">
            <div class="fade-in">
                <h2 class="text-3xl font-bold text-dark-slate mb-6">
                    <i class="fas fa-chart-line text-sage mr-3"></i>대시보드
                </h2>
                
                <!-- Visitor Stats Row -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-8">
                    <div class="bg-gradient-to-br from-purple-500 to-indigo-600 rounded-xl shadow-lg p-6 text-white hover-lift">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <p class="text-sm text-purple-100 mb-1">오늘 방문자</p>
                                <div class="flex items-baseline gap-2">
                                    <p class="text-4xl font-bold" id="stat-visitors-today">-</p>
                                    <p class="text-sm font-medium" id="stat-visitors-today-change"></p>
                                </div>
                                <p class="text-xs text-purple-200 mt-2">
                                    <i class="fas fa-clock mr-1"></i>자정에 자동 리셋
                                </p>
                                <button onclick="resetVisitorStats('today')" 
                                        class="mt-3 bg-white bg-opacity-20 hover:bg-opacity-30 text-white text-xs px-3 py-1.5 rounded-lg transition">
                                    <i class="fas fa-redo mr-1"></i>오늘 통계 리셋
                                </button>
                            </div>
                            <i class="fas fa-users text-5xl opacity-20"></i>
                        </div>
                    </div>
                    <div class="bg-gradient-to-br from-blue-500 to-cyan-600 rounded-xl shadow-lg p-6 text-white hover-lift">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <p class="text-sm text-blue-100 mb-1">전체 방문자</p>
                                <p class="text-4xl font-bold" id="stat-visitors-total">-</p>
                                <p class="text-xs text-blue-200 mt-2">
                                    <i class="fas fa-chart-line mr-1"></i>누적 방문 수
                                </p>
                                <button onclick="resetVisitorStats('all')" 
                                        class="mt-3 bg-white bg-opacity-20 hover:bg-opacity-30 text-white text-xs px-3 py-1.5 rounded-lg transition">
                                    <i class="fas fa-trash-alt mr-1"></i>전체 통계 리셋
                                </button>
                            </div>
                            <i class="fas fa-globe text-5xl opacity-20"></i>
                        </div>
                    </div>
                </div>

                <!-- Stats Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-sage hover-lift">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">전체 회원</p>
                                <p class="text-3xl font-bold text-sage" id="stat-users">-</p>
                            </div>
                            <i class="fas fa-users text-4xl text-sage opacity-20"></i>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-lavender hover-lift">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">전체 제품</p>
                                <p class="text-3xl font-bold text-lavender" id="stat-products">-</p>
                            </div>
                            <i class="fas fa-box text-4xl text-lavender opacity-20"></i>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-blue-500 hover-lift">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">워크샵</p>
                                <p class="text-3xl font-bold text-blue-600" id="stat-workshops">-</p>
                            </div>
                            <i class="fas fa-hands-helping text-4xl text-blue-500 opacity-20"></i>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-green-500 hover-lift">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">원데이 클래스</p>
                                <p class="text-3xl font-bold text-green-600" id="stat-classes">-</p>
                            </div>
                            <i class="fas fa-chalkboard-teacher text-4xl text-green-500 opacity-20"></i>
                        </div>
                    </div>
                </div>

                <!-- Charts Row -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- Weekly Visitors Chart -->
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-chart-area text-sage mr-2"></i>주간 방문자 추이
                        </h3>
                        <canvas id="weeklyVisitorsChart" style="max-height: 250px;"></canvas>
                    </div>
                    
                    <!-- Device Stats -->
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-mobile-alt text-sage mr-2"></i>디바이스 통계
                        </h3>
                        <canvas id="deviceStatsChart" style="max-height: 250px;"></canvas>
                    </div>
                </div>
                
                <!-- Recent Activity Row -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- Recent Users -->
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-user-plus text-sage mr-2"></i>최근 가입 회원
                        </h3>
                        <div id="recent-users" class="space-y-3">
                            <p class="text-gray-500 text-sm text-center py-4">로딩 중...</p>
                        </div>
                    </div>
                    
                    <!-- Recent Activity -->
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4">
                            <i class="fas fa-history text-sage mr-2"></i>최근 활동 로그
                        </h3>
                        <div id="recent-activity" class="space-y-3">
                            <p class="text-gray-500 text-sm text-center py-4">로딩 중...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Users Section -->
        <div id="section-users" class="content-section hidden">
            <div class="fade-in">
                <h2 class="text-3xl font-bold text-dark-slate mb-6">
                    <i class="fas fa-users text-sage mr-3"></i>회원 관리
                </h2>

                <!-- User Stats Cards -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-sage hover-lift">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">전체 회원</p>
                                <p class="text-3xl font-bold text-sage" id="user-stat-total">0</p>
                            </div>
                            <i class="fas fa-users text-4xl text-sage opacity-20"></i>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-blue-500 hover-lift">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">B2C 회원</p>
                                <p class="text-3xl font-bold text-blue-600" id="user-stat-b2c">0</p>
                            </div>
                            <i class="fas fa-user text-4xl text-blue-500 opacity-20"></i>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-green-500 hover-lift">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">B2B 회원</p>
                                <p class="text-3xl font-bold text-green-600" id="user-stat-b2b">0</p>
                            </div>
                            <i class="fas fa-briefcase text-4xl text-green-500 opacity-20"></i>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-orange-500 hover-lift">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">신규 가입 (7일)</p>
                                <p class="text-3xl font-bold text-orange-600" id="user-stat-new">0</p>
                            </div>
                            <i class="fas fa-user-plus text-4xl text-orange-500 opacity-20"></i>
                        </div>
                    </div>
                </div>

                <!-- Detailed User Analytics -->
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <!-- User Type Breakdown -->
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">
                            <i class="fas fa-chart-pie text-sage mr-2"></i>회원 유형별
                        </h3>
                        <canvas id="userTypeChart" style="max-height: 200px;"></canvas>
                    </div>
                    
                    <!-- B2C Stress Type -->
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">
                            <i class="fas fa-heartbeat text-blue-500 mr-2"></i>B2C 스트레스 유형
                        </h3>
                        <canvas id="stressTypeChart" style="max-height: 200px;"></canvas>
                    </div>
                    
                    <!-- B2B Category -->
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">
                            <i class="fas fa-building text-green-500 mr-2"></i>B2B 업종별
                        </h3>
                        <canvas id="b2bCategoryChart" style="max-height: 200px;"></canvas>
                    </div>
                </div>
                
                <!-- Occupation and Life Situation Analysis -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- Work Stress - Occupation -->
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">
                            <i class="fas fa-briefcase text-indigo-500 mr-2"></i>직무 스트레스 - 업종별
                        </h3>
                        <canvas id="occupationChart" style="max-height: 300px;"></canvas>
                    </div>
                    
                    <!-- Daily Stress - Life Situation -->
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">
                            <i class="fas fa-home text-purple-500 mr-2"></i>일상 스트레스 - 생활 상황별
                        </h3>
                        <canvas id="lifeSituationChart" style="max-height: 300px;"></canvas>
                    </div>
                </div>
                
                <!-- Region and Demographics -->
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                    <!-- Region Distribution -->
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-lg font-bold text-gray-800 mb-4">
                            <i class="fas fa-map-marked-alt text-sage mr-2"></i>지역별 분포
                        </h3>
                        <canvas id="regionChart" style="max-height: 300px;"></canvas>
                    </div>
                    
                    <!-- Gender and Signup Trend -->
                    <div class="grid grid-rows-2 gap-6">
                        <!-- Gender Distribution -->
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">
                                <i class="fas fa-venus-mars text-sage mr-2"></i>성별 분포
                            </h3>
                            <canvas id="genderChart" style="max-height: 120px;"></canvas>
                        </div>
                        
                        <!-- Monthly Signup Trend (Mini) -->
                        <div class="bg-white rounded-xl shadow-md p-6">
                            <h3 class="text-lg font-bold text-gray-800 mb-4">
                                <i class="fas fa-chart-line text-sage mr-2"></i>월별 가입 추이
                            </h3>
                            <canvas id="monthlySignupChart" style="max-height: 120px;"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Search and Filter -->
                <div class="bg-white rounded-xl shadow-md p-4 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <input type="text" id="user-search" placeholder="이름, 이메일 검색..." 
                            class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sage focus:border-transparent">
                        <select id="user-type-filter" 
                            class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sage focus:border-transparent">
                            <option value="">전체 회원 유형</option>
                            <option value="B2C">개인 (B2C)</option>
                            <option value="B2B">기업 (B2B)</option>
                        </select>
                        <button onclick="searchUsers()" 
                            class="bg-sage text-white px-6 py-2 rounded-lg hover:opacity-90 transition font-semibold">
                            <i class="fas fa-search mr-2"></i>검색
                        </button>
                    </div>
                </div>

                <!-- Users Table -->
                <div class="bg-white rounded-xl shadow-md overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 border-b">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">이름</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">이메일</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">회원유형</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">역할</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">가입일</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">상태</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body">
                                <tr>
                                    <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                                        <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                                        <p>데이터를 불러오는 중...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="px-6 py-4 border-t bg-gray-50">
                        <p class="text-sm text-gray-600">총 <span id="users-total">0</span>명</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Products Section -->
        <div id="section-products" class="content-section hidden">
            <div class="fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-dark-slate">
                        <i class="fas fa-box text-sage mr-3"></i>제품 관리
                    </h2>
                    <button onclick="openProductModal()" 
                        class="bg-sage text-white px-6 py-3 rounded-lg hover:opacity-90 transition font-semibold">
                        <i class="fas fa-plus mr-2"></i>제품 등록
                    </button>
                </div>

                <!-- Products Grid -->
                <div id="products-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="col-span-full text-center py-12 text-gray-500">
                        <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                        <p>데이터를 불러오는 중...</p>
                    </div>
                </div>
            </div>
        </div>


        <!-- Blog Section -->
        <div id="section-blog" class="content-section hidden">
            <div class="fade-in">
                <h2 class="text-3xl font-bold text-dark-slate mb-6">
                    <i class="fas fa-blog text-sage mr-3"></i>블로그 댓글 분석 & 관리
                </h2>

                <!-- Stats Overview -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-lavender hover-lift">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">총 댓글</p>
                                <p class="text-3xl font-bold text-lavender" id="blog-stat-comments">0</p>
                            </div>
                            <i class="fas fa-comments text-4xl text-lavender opacity-20"></i>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-blue-500 hover-lift">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">B2C 사용자</p>
                                <p class="text-3xl font-bold text-blue-600" id="blog-stat-b2c">0</p>
                            </div>
                            <i class="fas fa-user text-4xl text-blue-500 opacity-20"></i>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-green-500 hover-lift">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">B2B 사용자</p>
                                <p class="text-3xl font-bold text-green-600" id="blog-stat-b2b">0</p>
                            </div>
                            <i class="fas fa-briefcase text-4xl text-green-500 opacity-20"></i>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-orange-500 hover-lift">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">평균 전환율</p>
                                <p class="text-3xl font-bold text-orange-600" id="blog-stat-conversion">0%</p>
                            </div>
                            <i class="fas fa-chart-line text-4xl text-orange-500 opacity-20"></i>
                        </div>
                    </div>
                </div>

                <!-- Sub Tabs -->
                <div class="bg-white rounded-xl shadow-md mb-6">
                    <div class="border-b border-gray-200">
                        <nav class="flex space-x-8 px-6" aria-label="Tabs">
                            <button onclick="switchBlogSubTab('high-leads')" 
                                class="blog-sub-tab-btn border-b-2 border-lavender py-4 px-1 text-sm font-medium text-lavender">
                                <i class="fas fa-star mr-2"></i>고전환율 리드
                            </button>
                            <button onclick="switchBlogSubTab('posts')" 
                                class="blog-sub-tab-btn border-b-2 border-transparent py-4 px-1 text-sm font-medium text-gray-500 hover:text-gray-700">
                                <i class="fas fa-blog mr-2"></i>블로그 포스트
                            </button>
                            <button onclick="switchBlogSubTab('add-post')" 
                                class="blog-sub-tab-btn border-b-2 border-transparent py-4 px-1 text-sm font-medium text-gray-500 hover:text-gray-700">
                                <i class="fas fa-plus mr-2"></i>포스트 추가
                            </button>
                            <button onclick="switchBlogSubTab('add-comment')" 
                                class="blog-sub-tab-btn border-b-2 border-transparent py-4 px-1 text-sm font-medium text-gray-500 hover:text-gray-700">
                                <i class="fas fa-comment-medical mr-2"></i>댓글 추가
                            </button>
                        </nav>
                    </div>
                </div>

                <!-- High Conversion Leads Sub Tab -->
                <div id="blog-high-leads-tab" class="blog-sub-content">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-2xl font-bold text-gray-800">
                                <i class="fas fa-bullseye mr-2 text-lavender"></i>
                                회원가입 유도 대상
                            </h3>
                            <div class="flex items-center space-x-4">
                                <label class="text-sm text-gray-600">최소 전환율:</label>
                                <select id="blog-min-conversion-filter" onchange="loadBlogHighLeads()" 
                                    class="border border-gray-300 rounded-lg px-3 py-2 focus:ring-2 focus:ring-lavender">
                                    <option value="0.5">50%</option>
                                    <option value="0.6" selected>60%</option>
                                    <option value="0.7">70%</option>
                                    <option value="0.8">80%</option>
                                </select>
                            </div>
                        </div>
                        <div id="blog-high-leads-list" class="space-y-4">
                            <div class="text-center py-12 text-gray-500">
                                <i class="fas fa-spinner fa-spin text-4xl mb-4"></i>
                                <p>로딩 중...</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Blog Posts Sub Tab -->
                <div id="blog-posts-tab" class="blog-sub-content hidden">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h3 class="text-2xl font-bold text-gray-800">
                                <i class="fas fa-blog mr-2 text-lavender"></i>
                                등록된 블로그 포스트
                            </h3>
                            <button onclick="crawlAllBlogComments()" id="crawl-all-btn"
                                class="px-6 py-3 bg-gradient-to-r from-lavender to-purple-600 text-white rounded-lg font-semibold hover:shadow-lg transition-all duration-300 flex items-center space-x-2">
                                <i class="fas fa-sync-alt"></i>
                                <span>모든 댓글 수집</span>
                            </button>
                        </div>
                        
                        <!-- Crawling Progress (hidden by default) -->
                        <div id="crawl-progress-container" class="hidden mb-6">
                            <div class="bg-blue-50 border-l-4 border-blue-500 p-4 rounded-lg">
                                <div class="flex items-center justify-between mb-2">
                                    <p class="text-sm font-semibold text-blue-800">
                                        <i class="fas fa-spinner fa-spin mr-2"></i>
                                        댓글 수집 중...
                                    </p>
                                    <p class="text-sm text-blue-700" id="crawl-progress-text">0 / 0</p>
                                </div>
                                <div class="w-full bg-blue-200 rounded-full h-4 overflow-hidden">
                                    <div id="crawl-progress-bar" class="bg-blue-600 h-4 transition-all duration-300" style="width: 0%"></div>
                                </div>
                                <p class="text-xs text-blue-600 mt-2" id="crawl-status-text">준비 중...</p>
                            </div>
                        </div>
                        
                        <!-- Crawl Results Summary (hidden by default) -->
                        <div id="crawl-results-container" class="hidden mb-6">
                            <div class="bg-green-50 border-l-4 border-green-500 p-4 rounded-lg">
                                <h4 class="text-sm font-semibold text-green-800 mb-2">
                                    <i class="fas fa-check-circle mr-2"></i>
                                    수집 완료
                                </h4>
                                <div class="grid grid-cols-3 gap-4 text-center">
                                    <div>
                                        <p class="text-2xl font-bold text-green-700" id="crawl-result-total">0</p>
                                        <p class="text-xs text-gray-600">총 댓글</p>
                                    </div>
                                    <div>
                                        <p class="text-2xl font-bold text-blue-600" id="crawl-result-success">0</p>
                                        <p class="text-xs text-gray-600">성공</p>
                                    </div>
                                    <div>
                                        <p class="text-2xl font-bold text-red-600" id="crawl-result-fail">0</p>
                                        <p class="text-xs text-gray-600">실패</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div id="blog-posts-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                            <p class="col-span-full text-center text-gray-500 py-12">포스트를 불러오는 중...</p>
                        </div>
                    </div>
                </div>

                <!-- Add Post Sub Tab -->
                <div id="blog-add-post-tab" class="blog-sub-content hidden">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6">
                            <i class="fas fa-plus mr-2 text-lavender"></i>
                            새 블로그 게시물 추가
                        </h3>
                        
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
                            <p class="text-sm text-blue-700">
                                <strong>Step 1:</strong> 먼저 네이버 블로그 게시물 URL을 입력하여 게시물을 등록하세요.
                            </p>
                        </div>

                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    블로그 게시물 URL *
                                </label>
                                <input type="url" id="blog-post-url" required
                                    placeholder="예: https://blog.naver.com/aromapulse/223871244762"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-lavender focus:border-transparent">
                            </div>

                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">
                                    작성 날짜 (선택)
                                </label>
                                <input type="text" id="blog-post-date"
                                    placeholder="예: 2025-04-29 09:00 (날짜와 시간을 수동 작성)"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-lavender focus:border-transparent">
                                <p class="text-xs text-gray-500 mt-2">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    비워두면 현재 시간으로 설정됩니다. 형식: 2025-04-29 09:00 또는 2025-04-29 (시간 생략 시 현재 시각) 또는 09:00 (오늘 날짜)
                                </p>
                            </div>

                            <div class="flex space-x-3">
                                <button onclick="addBlogPost()" 
                                    class="flex-1 bg-lavender text-white px-6 py-3 rounded-lg hover:opacity-90 transition font-semibold">
                                    <i class="fas fa-plus mr-2"></i>게시물 추가
                                </button>
                                <button onclick="resetBlogPostForm()" 
                                    class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition font-semibold">
                                    <i class="fas fa-redo mr-2"></i>초기화
                                </button>
                            </div>

                            <p class="text-xs text-gray-500">
                                <i class="fas fa-lightbulb mr-1"></i>
                                게시물 추가 후 "댓글 추가" 탭에서 댓글을 입력할 수 있습니다.
                            </p>
                        </div>
                    </div>
                </div>

                <!-- Add Comment Sub Tab -->
                <div id="blog-add-comment-tab" class="blog-sub-content hidden">
                    <div class="bg-white rounded-xl shadow-md p-6">
                        <h3 class="text-2xl font-bold text-gray-800 mb-6">
                            <i class="fas fa-comment-medical mr-2 text-lavender"></i>
                            수동 댓글 추가
                        </h3>
                        
                        <div class="bg-blue-50 border-l-4 border-blue-500 p-4 mb-6">
                            <p class="text-sm text-blue-700">
                                중요한 댓글을 직접 입력하여 분석하고 관리할 수 있습니다.
                            </p>
                        </div>

                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">블로그 게시물 *</label>
                                <select id="comment-post-id" 
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-lavender">
                                    <option value="">게시물을 선택하세요</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">작성자명 *</label>
                                <input type="text" id="comment-author" placeholder="예: 홍길동"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-lavender">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">댓글 내용 *</label>
                                <textarea id="comment-content" rows="4" placeholder="댓글 내용을 입력하세요..."
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-lavender"></textarea>
                                <p class="text-xs text-gray-500 mt-2">
                                    <i class="fas fa-robot mr-1"></i>
                                    입력된 댓글은 자동으로 AI 분석됩니다 (감정, 의도, 사용자 타입, 키워드)
                                </p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">작성 날짜 (선택)</label>
                                <input type="text" id="comment-date" placeholder="예: 2025-04-29 09:00"
                                    class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-lavender">
                                <p class="text-xs text-gray-500 mt-2">
                                    <i class="fas fa-info-circle mr-1"></i>
                                    비워두면 현재 시간으로 설정됩니다.
                                </p>
                            </div>
                            
                            <div class="flex space-x-3">
                                <button onclick="addBlogComment()" 
                                    class="flex-1 bg-lavender text-white px-6 py-3 rounded-lg hover:opacity-90 transition font-semibold">
                                    <i class="fas fa-magic mr-2"></i>댓글 추가 및 분석
                                </button>
                                <button onclick="resetBlogCommentForm()" 
                                    class="px-6 py-3 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 transition font-semibold">
                                    <i class="fas fa-redo mr-2"></i>초기화
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- Workshops Section -->
        <div id="section-workshops" class="content-section hidden">
            <div class="fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-dark-slate">
                        <i class="fas fa-hands-helping text-sage mr-3"></i>워크샵 관리
                    </h2>
                    <button onclick="openWorkshopModal()" 
                        class="bg-sage text-white px-6 py-3 rounded-lg hover:opacity-90 transition font-semibold">
                        <i class="fas fa-plus mr-2"></i>워크샵 등록
                    </button>
                </div>

                <!-- Workshops Grid -->
                <div id="workshops-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="col-span-full text-center py-12 text-gray-500">
                        <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                        <p>데이터를 불러오는 중...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Classes Section -->
        <div id="section-classes" class="content-section hidden">
            <div class="fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-dark-slate">
                        <i class="fas fa-chalkboard-teacher text-sage mr-3"></i>원데이 클래스 관리
                    </h2>
                    <button onclick="openClassModal()" 
                        class="bg-sage text-white px-6 py-3 rounded-lg hover:opacity-90 transition font-semibold">
                        <i class="fas fa-plus mr-2"></i>클래스 등록
                    </button>
                </div>

                <!-- Classes Grid -->
                <div id="classes-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="col-span-full text-center py-12 text-gray-500">
                        <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                        <p>데이터를 불러오는 중...</p>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Product Modal -->
    <div id="product-modal" class="hidden fixed inset-0 modal-backdrop z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <div class="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center">
                    <h3 class="text-2xl font-bold text-gray-800">
                        <i class="fas fa-box mr-2"></i><span id="product-modal-title">제품 등록</span>
                    </h3>
                    <button onclick="closeProductModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                <form id="product-form" class="p-6" onsubmit="saveProduct(event)">
                    <input type="hidden" id="product-id">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">제품명</label>
                            <input type="text" id="product-name" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">가격 (원)</label>
                                <input type="number" id="product-price" required min="0" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">재고</label>
                                <input type="number" id="product-stock" required min="0" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">설명</label>
                            <textarea id="product-description" rows="3" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage"></textarea>
                        </div>
                        <div>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="product-is-active" checked class="w-5 h-5 text-sage rounded">
                                <span class="text-sm font-semibold text-gray-700">판매중</span>
                            </label>
                        </div>
                    </div>
                    <div class="mt-6 flex space-x-3">
                        <button type="submit" class="flex-1 bg-sage text-white px-6 py-3 rounded-lg hover:opacity-90 font-semibold">
                            <i class="fas fa-save mr-2"></i>저장
                        </button>
                        <button type="button" onclick="closeProductModal()" class="flex-1 bg-gray-300 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-400 font-semibold">
                            <i class="fas fa-times mr-2"></i>취소
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Workshop Modal -->
    <div id="workshop-modal" class="hidden fixed inset-0 modal-backdrop z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <div class="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center">
                    <h3 class="text-2xl font-bold text-gray-800">
                        <i class="fas fa-hands-helping mr-2"></i><span id="workshop-modal-title">워크샵 등록</span>
                    </h3>
                    <button onclick="closeWorkshopModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                <form id="workshop-form" class="p-6" onsubmit="saveWorkshop(event)">
                    <input type="hidden" id="workshop-id">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">워크샵명</label>
                            <input type="text" id="workshop-title" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">설명</label>
                            <textarea id="workshop-description" rows="3" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage"></textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">가격 (원)</label>
                                <input type="number" id="workshop-price" required min="0" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">소요시간 (분)</label>
                                <input type="number" id="workshop-duration" required min="0" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">최대 참여자</label>
                                <input type="number" id="workshop-max-participants" required min="1" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">지역</label>
                                <input type="text" id="workshop-location" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage">
                            </div>
                        </div>
                        <div>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="workshop-is-active" checked class="w-5 h-5 text-sage rounded">
                                <span class="text-sm font-semibold text-gray-700">활성</span>
                            </label>
                        </div>
                    </div>
                    <div class="mt-6 flex space-x-3">
                        <button type="submit" class="flex-1 bg-sage text-white px-6 py-3 rounded-lg hover:opacity-90 font-semibold">
                            <i class="fas fa-save mr-2"></i>저장
                        </button>
                        <button type="button" onclick="closeWorkshopModal()" class="flex-1 bg-gray-300 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-400 font-semibold">
                            <i class="fas fa-times mr-2"></i>취소
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main JavaScript -->
    <script src="/static/admin-dashboard.js?v=20251119078"></script>
</body>
</html>
