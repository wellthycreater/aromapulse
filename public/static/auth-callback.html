<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë¡œê·¸ì¸ ì¤‘...</title>
    <link rel="icon" type="image/png" href="/static/favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gradient-to-br from-purple-50 to-pink-50 min-h-screen flex items-center justify-center">
    <div class="text-center">
        <div class="inline-block animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-purple-600 mb-4"></div>
        <p class="text-xl font-semibold text-gray-700">ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘...</p>
        <p class="text-sm text-gray-500 mt-2">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”</p>
    </div>
    
    <script>
        // ì¿ í‚¤ì—ì„œ í† í° ì½ê¸°
        function getCookie(name) {
            const value = `; ${document.cookie}`;
            const parts = value.split(`; ${name}=`);
            if (parts.length === 2) return parts.pop().split(';').shift();
            return null;
        }
        
        // ì¦‰ì‹œ ì‹¤í–‰
        (function() {
            console.log('[AUTH-CALLBACK] Starting authentication callback processing');
            
            // ì¿ í‚¤ì—ì„œ auth_token í™•ì¸
            const token = getCookie('auth_token');
            console.log('[AUTH-CALLBACK] Token from cookie:', token ? 'Found' : 'Not found');
            
            if (token) {
                // í† í° ë””ì½”ë”©í•˜ì—¬ ì‚¬ìš©ì ì •ë³´ ì¶”ì¶œ
                try {
                    const payload = JSON.parse(atob(token.split('.')[1]));
                    console.log('[AUTH-CALLBACK] Token payload:', payload);
                    
                    const user = {
                        id: payload.userId,
                        email: payload.email,
                        name: payload.name,
                        user_type: payload.userType,
                        role: payload.role || 'user'
                    };
                    
                    // localStorageì— ì €ì¥
                    localStorage.setItem('token', token);
                    localStorage.setItem('user', JSON.stringify(user));
                    
                    console.log('[AUTH-CALLBACK] Saved to localStorage - token:', !!localStorage.getItem('token'));
                    console.log('[AUTH-CALLBACK] Saved to localStorage - user:', !!localStorage.getItem('user'));
                    console.log('[AUTH-CALLBACK] User info:', user);
                    
                    // ğŸ”‘ wellthy ê³„ì •ì€ ì¼ë°˜ ì‚¬ìš©ìì²˜ëŸ¼ í™ˆìœ¼ë¡œ (ì›Œí¬ìƒµ ì ‘ê·¼ ê¶Œí•œë§Œ íŠ¹ë³„ ë¶€ì—¬)
                    // super_adminë§Œ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œë¡œ ì´ë™
                    let redirectUrl = '/';
                    if (user.role === 'super_admin') {
                        redirectUrl = '/admin-products';
                    }
                    
                    console.log('[AUTH-CALLBACK] Redirecting to:', redirectUrl);
                    
                    // ì¿ í‚¤ ì •ë¦¬ (ì„ íƒì‚¬í•­)
                    document.cookie = 'auth_token=; Path=/; Max-Age=0';
                    
                    // ë¦¬ë‹¤ì´ë ‰íŠ¸
                    setTimeout(() => {
                        window.location.href = redirectUrl;
                    }, 500);
                    
                } catch (error) {
                    console.error('[AUTH-CALLBACK] Token parsing error:', error);
                    alert('ë¡œê·¸ì¸ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                    window.location.href = '/login';
                }
            } else {
                console.error('[AUTH-CALLBACK] No token found in cookie');
                alert('ë¡œê·¸ì¸ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
                window.location.href = '/login';
            }
        })();
    </script>
</body>
</html>
