# AromaPulse - SNS & O2O Analytics í”„ë¡œë•ì…˜ ë°°í¬ ê°€ì´ë“œ

## ğŸš€ ë°°í¬ ì¤€ë¹„ ì™„ë£Œ

SNS ì±„ë„ ì¶”ì  ë° ì˜¨ë¼ì¸â†’ì˜¤í”„ë¼ì¸(O2O) ì „í™˜ìœ¨ ë¶„ì„ ê¸°ëŠ¥ì´ ì™„ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## ğŸ“Š êµ¬í˜„ëœ ê¸°ëŠ¥

### 1. SNS ì±„ë„ ìœ ì… ì¶”ì 
- **ë¸”ë¡œê·¸**, **ì¸ìŠ¤íƒ€ê·¸ë¨**, **ìœ íŠœë¸Œ** 3ê°œ ì±„ë„ ë°©ë¬¸ì ì¶”ì 
- ì¼ë³„ ë°©ë¬¸ì ìˆ˜, ê³ ìœ  ë°©ë¬¸ì ìˆ˜, í´ë¦­ ìˆ˜ ê¸°ë¡
- ì±„ë„ë³„ CTR(í´ë¦­ë¥ ) ê³„ì‚° ë° ë¹„êµ

### 2. O2O ì „í™˜ ë¶„ì„
- ì˜¨ë¼ì¸ ìœ ì… â†’ ì˜¤í”„ë¼ì¸ ê³µë°© ì „í™˜ ì¶”ì 
- **ê³µë°© ìœ„ì¹˜ë³„** ì „í™˜ í†µê³„ (ê°•ë‚¨, í™ëŒ€, ì´íƒœì›, ì„±ìˆ˜, ì—°ë‚¨, ì‚¼ì²­ë™ ë“±)
- **ì „í™˜ ìœ í˜•ë³„** í†µê³„ (ì›Œí¬ìƒµ ì˜ˆì•½, í´ë˜ìŠ¤ ì˜ˆì•½, ìƒë‹´, ë°©ë¬¸)
- **SNS ì±„ë„ë³„** ì „í™˜ìœ¨ ë° ë§¤ì¶œ ë¹„êµ

### 3. ëŒ€ì‹œë³´ë“œ ì‹œê°í™”
- **SNS ì±„ë„ë³„ ìœ ì…**: ë°” ì°¨íŠ¸ (ë°©ë¬¸ì vs í´ë¦­ ìˆ˜)
- **SNS í´ë¦­ë¥  (CTR)**: ë„ë„› ì°¨íŠ¸ (ì±„ë„ë³„ ë¹„êµ)
- **ì¼ë³„ SNS ì¶”ì´**: ë¼ì¸ ì°¨íŠ¸ (30ì¼ê°„ íŠ¸ë Œë“œ)
- **ê³µë°©ë³„ O2O ì „í™˜**: ê°€ë¡œ ë°” ì°¨íŠ¸ (ì „í™˜ ìˆ˜ ë° ë§¤ì¶œ)
- **SNSë³„ O2O ì „í™˜ìœ¨**: ì´ì¤‘ ì¶• ë°” ì°¨íŠ¸ (ì „í™˜ ìˆ˜ + ë§¤ì¶œ)

---

## ğŸ—„ï¸ ë°ì´í„°ë² ì´ìŠ¤ ë³€ê²½ì‚¬í•­

### ìƒˆë¡œìš´ í…Œì´ë¸”
1. **`sns_visits`**: SNS ì±„ë„ ë°©ë¬¸ ê¸°ë¡ (ì¼ë³„)
2. **`o2o_conversions`**: ì˜¨ë¼ì¸â†’ì˜¤í”„ë¼ì¸ ì „í™˜ ê¸°ë¡

### ì‚¬ìš©ì í…Œì´ë¸” ì¶”ê°€ ì»¬ëŸ¼
- **`referral_source`**: ì‚¬ìš©ì ìœ ì… ê²½ë¡œ (blog, instagram, youtube, direct ë“±)

### ìƒ˜í”Œ ë°ì´í„°
- **SNS ë°©ë¬¸ ë°ì´í„°**: ìµœê·¼ 30ì¼, 3ê°œ ì±„ë„, ì´ 10,085 ë°©ë¬¸
- **O2O ì „í™˜ ë°ì´í„°**: 29ê±´ì˜ ì „í™˜, 6ê°œ ê³µë°© ìœ„ì¹˜, 4ê°€ì§€ ì „í™˜ ìœ í˜•

---

## ğŸ“ í”„ë¡œë•ì…˜ ë°°í¬ ë‹¨ê³„

### âš ï¸ ì‚¬ì „ ì¤€ë¹„: Cloudflare API í‚¤ ì„¤ì •

í”„ë¡œë•ì…˜ ë°°í¬ ì „ì— **ë°˜ë“œì‹œ** Cloudflare API í‚¤ë¥¼ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤:

1. **Deploy íƒ­**ìœ¼ë¡œ ì´ë™
2. Cloudflare ëŒ€ì‹œë³´ë“œì—ì„œ API í† í° ìƒì„±:
   - **Account** > **API Tokens** ë©”ë‰´
   - **Create Token** í´ë¦­
   - **Edit Cloudflare Workers** í…œí”Œë¦¿ ì„ íƒ
   - Permissions ì„¤ì •:
     - Account > Cloudflare Pages: Edit
     - Account > D1: Edit
   - **Continue to summary** â†’ **Create Token**
3. ìƒì„±ëœ í† í°ì„ ë³µì‚¬í•˜ì—¬ Deploy íƒ­ì— ì €ì¥

---

### 1ë‹¨ê³„: í”„ë¡œë•ì…˜ ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©

```bash
# ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš© (2ê°œì˜ ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼)
npx wrangler d1 migrations apply aromapulse-production --remote

# ì ìš©ë˜ëŠ” ë§ˆì´ê·¸ë ˆì´ì…˜:
# - 0024_add_referral_tracking.sql (referral_source ì»¬ëŸ¼ ì¶”ê°€)
# - 0024_add_sns_tracking.sql (sns_visits, o2o_conversions í…Œì´ë¸” ìƒì„±)
```

### 2ë‹¨ê³„: ìƒ˜í”Œ ë°ì´í„° ì‚½ì… (í”„ë¡œë•ì…˜)

```bash
# SNS ë° O2O ìƒ˜í”Œ ë°ì´í„° ì‚½ì…
npx wrangler d1 execute aromapulse-production --remote --file=./seed_sns_and_o2o_data.sql

# ì‚½ì…ë˜ëŠ” ë°ì´í„°:
# - sns_visits: 45ê±´ (ë¸”ë¡œê·¸ 15ì¼ + ì¸ìŠ¤íƒ€ 15ì¼ + ìœ íŠœë¸Œ 15ì¼)
# - o2o_conversions: 29ê±´ (ë¸”ë¡œê·¸ 8ê±´ + ì¸ìŠ¤íƒ€ 10ê±´ + ìœ íŠœë¸Œ 6ê±´ + ê¸°íƒ€ 5ê±´)
# - users.referral_source ì—…ë°ì´íŠ¸: 29ëª…ì˜ ê¸°ì¡´ ì‚¬ìš©ì
```

### 3ë‹¨ê³„: í”„ë¡œë•ì…˜ ë°°í¬

```bash
# í”„ë¡œì íŠ¸ ë¹Œë“œ
npm run build

# Cloudflare Pagesì— ë°°í¬
npx wrangler pages deploy dist --project-name aromapulse

# ë°°í¬ ì™„ë£Œ í›„ ì ‘ì† URL:
# https://www.aromapulse.kr/static/admin-dashboard
```

---

## âœ… ë°°í¬ í™•ì¸

ë°°í¬ í›„ ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œì—ì„œ ë‹¤ìŒ ì‚¬í•­ì„ í™•ì¸í•˜ì„¸ìš”:

### 1. SNS ìœ ì… ì°¨íŠ¸
- [ ] "SNS ì±„ë„ë³„ ìœ ì…" ë°” ì°¨íŠ¸ì— ë¸”ë¡œê·¸/ì¸ìŠ¤íƒ€/ìœ íŠœë¸Œ ë°ì´í„° í‘œì‹œ
- [ ] "SNS í´ë¦­ë¥  (CTR)" ë„ë„› ì°¨íŠ¸ì— ê° ì±„ë„ì˜ CTR ë¹„ìœ¨ í‘œì‹œ
- [ ] "ì¼ë³„ SNS ì¶”ì´" ë¼ì¸ ì°¨íŠ¸ì— 30ì¼ê°„ íŠ¸ë Œë“œ í‘œì‹œ

### 2. O2O ì „í™˜ ì°¨íŠ¸
- [ ] "ì˜¨ë¼ì¸â†’ì˜¤í”„ë¼ì¸ ì „í™˜" ê°€ë¡œ ë°” ì°¨íŠ¸ì— 6ê°œ ê³µë°© ìœ„ì¹˜ë³„ ì „í™˜ ìˆ˜ í‘œì‹œ
- [ ] "SNSë³„ O2O ì „í™˜ìœ¨" ì´ì¤‘ ì¶• ë°” ì°¨íŠ¸ì— ì „í™˜ ìˆ˜ì™€ ë§¤ì¶œ í‘œì‹œ

### 3. ë°ì´í„° ê²€ì¦
```bash
# í”„ë¡œë•ì…˜ DBì—ì„œ ë°ì´í„° í™•ì¸
npx wrangler d1 execute aromapulse-production --remote --command="SELECT COUNT(*) FROM sns_visits"
# ì˜ˆìƒ ê²°ê³¼: 45

npx wrangler d1 execute aromapulse-production --remote --command="SELECT COUNT(*) FROM o2o_conversions"
# ì˜ˆìƒ ê²°ê³¼: 29

npx wrangler d1 execute aromapulse-production --remote --command="SELECT referral_source, COUNT(*) FROM users WHERE referral_source IS NOT NULL GROUP BY referral_source"
# ì˜ˆìƒ ê²°ê³¼: blog(8), instagram(10), youtube(6), direct(3), other(2)
```

---

## ğŸ”§ ë¬¸ì œ í•´ê²°

### API í‚¤ ì˜¤ë¥˜
```
Error: The given account is not valid or is not authorized to access this service [code: 7403]
```
**í•´ê²° ë°©ë²•**: Deploy íƒ­ì—ì„œ Cloudflare API í‚¤ë¥¼ ë‹¤ì‹œ ì„¤ì •í•˜ì„¸ìš”.

### ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜¤ë¥˜
```
Error: FOREIGN KEY constraint failed
```
**í•´ê²° ë°©ë²•**: 
1. ë¡œì»¬ì—ì„œ ë§ˆì´ê·¸ë ˆì´ì…˜ í…ŒìŠ¤íŠ¸: `npx wrangler d1 migrations apply aromapulse-production --local`
2. ë¬¸ì œ ì—†ìœ¼ë©´ í”„ë¡œë•ì…˜ ì ìš©: `--remote` í”Œë˜ê·¸ ì‚¬ìš©

### ì°¨íŠ¸ ë°ì´í„° ì—†ìŒ
**ì›ì¸**: ìƒ˜í”Œ ë°ì´í„°ê°€ ì‚½ì…ë˜ì§€ ì•Šì•˜ê±°ë‚˜ API ì—”ë“œí¬ì¸íŠ¸ ì˜¤ë¥˜
**í™•ì¸**:
```bash
# API í…ŒìŠ¤íŠ¸ (ë¡œì»¬)
curl http://localhost:3000/api/admin/sns/stats -H "Authorization: Bearer YOUR_TOKEN"
curl http://localhost:3000/api/admin/o2o/stats -H "Authorization: Bearer YOUR_TOKEN"
```

---

## ğŸ“Š ìƒ˜í”Œ ë°ì´í„° ìš”ì•½

### SNS ë°©ë¬¸ í†µê³„ (ìµœê·¼ 30ì¼)
| ì±„ë„ | ì´ ë°©ë¬¸ì | ê³ ìœ  ë°©ë¬¸ì | í´ë¦­ ìˆ˜ | CTR |
|------|----------|-----------|---------|-----|
| ë¸”ë¡œê·¸ | 2,560 | 1,030 | 1,030 | 40.2% |
| ì¸ìŠ¤íƒ€ê·¸ë¨ | 5,715 | 2,116 | 2,116 | 37.0% |
| ìœ íŠœë¸Œ | 1,810 | 700 | 700 | 38.7% |

### O2O ì „í™˜ í†µê³„
| SNS ì±„ë„ | ì „í™˜ ìˆ˜ | ì´ ë§¤ì¶œ | í‰ê·  ë§¤ì¶œ |
|---------|---------|---------|----------|
| ë¸”ë¡œê·¸ | 8ê±´ | 800,000ì› | 100,000ì› |
| ì¸ìŠ¤íƒ€ê·¸ë¨ | 10ê±´ | 1,050,000ì› | 105,000ì› |
| ìœ íŠœë¸Œ | 6ê±´ | 658,000ì› | 109,667ì› |
| ê¸°íƒ€ | 5ê±´ | 497,000ì› | 99,400ì› |

### ê³µë°©ë³„ ì „í™˜ í†µê³„
| ê³µë°© ìœ„ì¹˜ | ì „í™˜ ìˆ˜ | ì´ ë§¤ì¶œ |
|---------|---------|---------|
| ê°•ë‚¨ ë¡œì»¬ ê³µë°© | 4ê±´ | 255,000ì› |
| í™ëŒ€ ì•„ë¡œë§ˆ ìŠ¤íŠœë””ì˜¤ | 6ê±´ | 584,000ì› |
| ì´íƒœì› í–¥ê¸° ê³µë°© | 4ê±´ | 285,000ì› |
| ì„±ìˆ˜ ì„¼íŠ¸ ìŠ¤í˜ì´ìŠ¤ | 4ê±´ | 440,000ì› |
| ì—°ë‚¨ë™ í–¥ìˆ˜ ì•„í‹€ë¦¬ì— | 4ê±´ | 590,000ì› |
| ì‚¼ì²­ë™ ì„¼íŠ¸ ê°¤ëŸ¬ë¦¬ | 3ê±´ | 325,000ì› |

---

## ğŸ“ ë³€ê²½ëœ íŒŒì¼

### ë°ì´í„°ë² ì´ìŠ¤
- `migrations/0024_add_referral_tracking.sql` - referral_source ì»¬ëŸ¼ ì¶”ê°€
- `migrations/0024_add_sns_tracking.sql` - SNS ë° O2O í…Œì´ë¸” ìƒì„±
- `seed_sns_and_o2o_data.sql` - ìƒ˜í”Œ ë°ì´í„° (45ê±´ SNS + 29ê±´ O2O)

### ë°±ì—”ë“œ
- `src/routes/admin.ts` - SNS ë° O2O í†µê³„ API ì—”ë“œí¬ì¸íŠ¸ ì¶”ê°€
  - `GET /api/admin/sns/stats` - SNS ì±„ë„ í†µê³„
  - `GET /api/admin/o2o/stats` - O2O ì „í™˜ í†µê³„

### í”„ë¡ íŠ¸ì—”ë“œ
- `public/static/admin-dashboard.html` - SNS ë° O2O ì°¨íŠ¸ ìº”ë²„ìŠ¤ ì¶”ê°€
- `public/static/admin-dashboard.js` - ì°¨íŠ¸ ë Œë”ë§ í•¨ìˆ˜ ì¶”ê°€
  - `loadSNSStats()`, `loadO2OStats()`
  - `renderSNSChannelChart()`, `renderSNSCTRChart()`, `renderDailySNSTrendChart()`
  - `renderO2OLocationChart()`, `renderO2OConversionRateChart()`

---

## ğŸ¯ ë‹¤ìŒ ë‹¨ê³„

1. **Cloudflare API í‚¤ ì„¤ì •** (Deploy íƒ­)
2. **í”„ë¡œë•ì…˜ ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©** (ìœ„ì˜ ëª…ë ¹ì–´ ì‹¤í–‰)
3. **ìƒ˜í”Œ ë°ì´í„° ì‚½ì…** (í”„ë¡œë•ì…˜ DB)
4. **Cloudflare Pages ë°°í¬** (`npm run build && npx wrangler pages deploy dist`)
5. **ëŒ€ì‹œë³´ë“œ í™•ì¸** (https://www.aromapulse.kr/static/admin-dashboard)

---

## ğŸ“ ë¬¸ì˜ ë° ì§€ì›

ë°°í¬ ì¤‘ ë¬¸ì œê°€ ë°œìƒí•˜ë©´ ë‹¤ìŒ ì •ë³´ì™€ í•¨ê»˜ ë¬¸ì˜í•˜ì„¸ìš”:
- ì—ëŸ¬ ë©”ì‹œì§€
- wrangler ë¡œê·¸ (`~/.config/.wrangler/logs/`)
- ë¸Œë¼ìš°ì € ì½˜ì†” ì—ëŸ¬ (ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ)

---

**ë°°í¬ ë‚ ì§œ**: 2024-01-15  
**ë§ˆì§€ë§‰ ì»¤ë°‹**: Add SNS channel tracking and O2O conversion analytics with dashboard charts  
**Git ë¸Œëœì¹˜**: main
