<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>아로마펄스 관리자</title>
    <link rel="icon" type="image/png" href="/static/favicon.png">
    <script>
        // 페이지 로드 전 즉시 인증 체크
        console.log('=== PRE-AUTH CHECK ===');
        const token = localStorage.getItem('adminToken') || localStorage.getItem('admin_token') || localStorage.getItem('auth_token') || localStorage.getItem('token');
        console.log('Token exists:', !!token);
        if (!token) {
            console.log('No token found, redirecting to login...');
            alert('로그인이 필요합니다.');
            window.location.href = '/admin-login';
        } else {
            console.log('Token found, proceeding to load page...');
        }
    </script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Custom Colors */
        :root {
            --sage-green: #7AA992;
            --lavender: #BCA6E0;
            --cream: #F3EDEA;
            --dark-slate: #263238;
            --medium-gray: #55606A;
            --light-gray: #E6ECEB;
        }
        
        .bg-sage { background-color: var(--sage-green); }
        .bg-lavender { background-color: var(--lavender); }
        .bg-cream { background-color: var(--cream); }
        .text-sage { color: var(--sage-green); }
        .text-lavender { color: var(--lavender); }
        .border-sage { border-color: var(--sage-green); }
        .hover\:bg-sage:hover { background-color: var(--sage-green); }
        .hover\:bg-lavender:hover { background-color: var(--lavender); }
        
        /* Tab Styling */
        .tab-button {
            transition: all 0.3s ease;
        }
        .tab-button.active {
            background-color: var(--sage-green);
            color: white;
            border-bottom: 3px solid var(--sage-green);
        }
        
        /* Sub-tab Styling */
        .sub-tab-button {
            transition: all 0.3s ease;
        }
        .sub-tab-button.active {
            background-color: var(--lavender);
            color: white;
        }
        
        /* Smooth transitions */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Custom scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--light-gray);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--sage-green);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6A9882;
        }
    </style>
</head>
<body class="bg-cream min-h-screen">
    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <div>
                        <h1 class="text-2xl font-bold text-sage">
                            <i class="fas fa-spa mr-2"></i>
                            아로마펄스 관리자
                        </h1>
                        <p class="text-xs text-gray-500 mt-1">AromaPulse Admin Dashboard</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-sm text-gray-600">
                        <i class="fas fa-user-circle mr-1"></i>
                        <span id="admin-name">관리자</span>
                    </div>
                    <button onclick="logout()" class="text-red-600 hover:text-red-700 transition">
                        <i class="fas fa-sign-out-alt mr-2"></i>로그아웃
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Navigation Tabs -->
    <div class="bg-white border-b shadow-sm">
        <div class="container mx-auto px-6">
            <div class="flex space-x-1 overflow-x-auto">
                <button onclick="switchMainTab('dashboard')" 
                    class="tab-button px-6 py-4 font-semibold whitespace-nowrap hover:bg-gray-100" 
                    data-tab="dashboard">
                    <i class="fas fa-chart-line mr-2"></i>대시보드
                </button>
                <button onclick="switchMainTab('users')" 
                    class="tab-button px-6 py-4 font-semibold whitespace-nowrap hover:bg-gray-100" 
                    data-tab="users">
                    <i class="fas fa-users mr-2"></i>회원 관리
                </button>
                <button onclick="switchMainTab('products')" 
                    class="tab-button px-6 py-4 font-semibold whitespace-nowrap hover:bg-gray-100 active" 
                    data-tab="products">
                    <i class="fas fa-box mr-2"></i>제품 관리
                </button>
                <button onclick="switchMainTab('blog')" 
                    class="tab-button px-6 py-4 font-semibold whitespace-nowrap hover:bg-gray-100" 
                    data-tab="blog">
                    <i class="fas fa-blog mr-2"></i>블로그 관리
                </button>
                <button onclick="switchMainTab('workshops')" 
                    class="tab-button px-6 py-4 font-semibold whitespace-nowrap hover:bg-gray-100" 
                    data-tab="workshops">
                    <i class="fas fa-hands-helping mr-2"></i>워크샵 관리
                </button>
                <button onclick="switchMainTab('classes')" 
                    class="tab-button px-6 py-4 font-semibold whitespace-nowrap hover:bg-gray-100" 
                    data-tab="classes">
                    <i class="fas fa-chalkboard-teacher mr-2"></i>원데이 클래스
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="container mx-auto px-6 py-8">
        
        <!-- Dashboard Section -->
        <div id="section-dashboard" class="content-section hidden">
            <div class="fade-in">
                <h2 class="text-3xl font-bold text-dark-slate mb-6">
                    <i class="fas fa-chart-line text-sage mr-3"></i>대시보드
                </h2>
                
                <!-- Stats Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-sage">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">전체 회원</p>
                                <p class="text-3xl font-bold text-sage" id="stat-users">0</p>
                            </div>
                            <i class="fas fa-users text-4xl text-sage opacity-20"></i>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-lavender">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">전체 제품</p>
                                <p class="text-3xl font-bold text-lavender" id="stat-products">0</p>
                            </div>
                            <i class="fas fa-box text-4xl text-lavender opacity-20"></i>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-blue-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">진행중 워크샵</p>
                                <p class="text-3xl font-bold text-blue-600" id="stat-workshops">0</p>
                            </div>
                            <i class="fas fa-hands-helping text-4xl text-blue-500 opacity-20"></i>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-green-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">원데이 클래스</p>
                                <p class="text-3xl font-bold text-green-600" id="stat-classes">0</p>
                            </div>
                            <i class="fas fa-chalkboard-teacher text-4xl text-green-500 opacity-20"></i>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-clock text-sage mr-2"></i>최근 활동
                    </h3>
                    <div id="recent-activity" class="space-y-3">
                        <p class="text-gray-500 text-center py-8">로딩 중...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Users Section -->
        <div id="section-users" class="content-section hidden">
            <div class="fade-in">
                <h2 class="text-3xl font-bold text-dark-slate mb-6">
                    <i class="fas fa-users text-sage mr-3"></i>회원 관리
                </h2>

                <!-- Sub-tabs for Users -->
                <div class="mb-6 flex flex-wrap gap-2">
                    <button onclick="switchUserTab('all')" 
                        class="sub-tab-button px-4 py-2 rounded-lg font-medium hover:bg-gray-200 active" 
                        data-user-tab="all">
                        <i class="fas fa-list mr-2"></i>전체 회원
                    </button>
                    <button onclick="switchUserTab('individual')" 
                        class="sub-tab-button px-4 py-2 rounded-lg font-medium hover:bg-gray-200" 
                        data-user-tab="individual">
                        <i class="fas fa-user mr-2"></i>개인 회원
                    </button>
                    <button onclick="switchUserTab('business')" 
                        class="sub-tab-button px-4 py-2 rounded-lg font-medium hover:bg-gray-200" 
                        data-user-tab="business">
                        <i class="fas fa-building mr-2"></i>기업 회원
                    </button>
                    <button onclick="switchUserTab('partner')" 
                        class="sub-tab-button px-4 py-2 rounded-lg font-medium hover:bg-gray-200" 
                        data-user-tab="partner">
                        <i class="fas fa-handshake mr-2"></i>공방 파트너
                    </button>
                    <button onclick="switchUserTab('admin')" 
                        class="sub-tab-button px-4 py-2 rounded-lg font-medium hover:bg-gray-200" 
                        data-user-tab="admin">
                        <i class="fas fa-user-shield mr-2"></i>관리자
                    </button>
                </div>

                <!-- Search and Filter -->
                <div class="bg-white rounded-xl shadow-md p-4 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <input type="text" id="user-search" placeholder="이름, 이메일 검색..." 
                            class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sage focus:border-transparent">
                        <select id="user-status-filter" 
                            class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sage focus:border-transparent">
                            <option value="">전체 상태</option>
                            <option value="1">활성</option>
                            <option value="0">비활성</option>
                        </select>
                        <button onclick="searchUsers()" 
                            class="bg-sage text-white px-6 py-2 rounded-lg hover:opacity-90 transition font-semibold">
                            <i class="fas fa-search mr-2"></i>검색
                        </button>
                    </div>
                </div>

                <!-- Users Table -->
                <div class="bg-white rounded-xl shadow-md overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 border-b">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">이름</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">이메일</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">회원유형</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">가입일</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">상태</th>
                                    <th class="px-6 py-3 text-center text-xs font-semibold text-gray-600 uppercase">관리</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body">
                                <tr>
                                    <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                                        <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                                        <p>데이터를 불러오는 중...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="px-6 py-4 border-t bg-gray-50">
                        <div class="flex items-center justify-between">
                            <p class="text-sm text-gray-600">총 <span id="users-total">0</span>명</p>
                            <div id="users-pagination"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Products Section -->
        <div id="section-products" class="content-section">
            <div class="fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-dark-slate">
                        <i class="fas fa-box text-sage mr-3"></i>제품 관리
                    </h2>
                    <button onclick="openProductModal()" 
                        class="bg-sage text-white px-6 py-3 rounded-lg hover:opacity-90 transition font-semibold">
                        <i class="fas fa-plus mr-2"></i>제품 등록
                    </button>
                </div>

                <!-- Filters -->
                <div class="bg-white rounded-xl shadow-md p-4 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                        <select id="product-concept-filter" 
                            class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sage focus:border-transparent">
                            <option value="">전체 컨셉</option>
                            <option value="symptom_care">증상 케어</option>
                            <option value="refresh">리프레시</option>
                        </select>
                        <select id="product-status-filter" 
                            class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sage focus:border-transparent">
                            <option value="">전체 상태</option>
                            <option value="1">판매중</option>
                            <option value="0">판매중지</option>
                        </select>
                        <input type="text" id="product-search" placeholder="제품명 검색..." 
                            class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sage focus:border-transparent md:col-span-2">
                    </div>
                </div>

                <!-- Products Table -->
                <div class="bg-white rounded-xl shadow-md overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 border-b">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">제품명</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">컨셉</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">가격</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">재고</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">상태</th>
                                    <th class="px-6 py-3 text-center text-xs font-semibold text-gray-600 uppercase">관리</th>
                                </tr>
                            </thead>
                            <tbody id="products-table-body">
                                <tr>
                                    <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                                        <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                                        <p>데이터를 불러오는 중...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="px-6 py-4 border-t bg-gray-50">
                        <div class="flex items-center justify-between">
                            <p class="text-sm text-gray-600">총 <span id="products-total">0</span>개</p>
                            <div id="products-pagination"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Blog Section -->
        <div id="section-blog" class="content-section hidden">
            <div class="fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-dark-slate">
                        <i class="fas fa-blog text-sage mr-3"></i>블로그 관리
                    </h2>
                    <button onclick="openBlogModal()" 
                        class="bg-sage text-white px-6 py-3 rounded-lg hover:opacity-90 transition font-semibold">
                        <i class="fas fa-plus mr-2"></i>포스트 작성
                    </button>
                </div>

                <!-- Blog Table -->
                <div class="bg-white rounded-xl shadow-md overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 border-b">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">제목</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">카테고리</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">조회수</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">작성일</th>
                                    <th class="px-6 py-3 text-center text-xs font-semibold text-gray-600 uppercase">관리</th>
                                </tr>
                            </thead>
                            <tbody id="blog-table-body">
                                <tr>
                                    <td colspan="5" class="px-6 py-8 text-center text-gray-500">
                                        <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                                        <p>데이터를 불러오는 중...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="px-6 py-4 border-t bg-gray-50">
                        <p class="text-sm text-gray-600">총 <span id="blog-total">0</span>개</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Workshops Section -->
        <div id="section-workshops" class="content-section hidden">
            <div class="fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-dark-slate">
                        <i class="fas fa-hands-helping text-sage mr-3"></i>워크샵 관리
                    </h2>
                    <button onclick="openWorkshopModal()" 
                        class="bg-sage text-white px-6 py-3 rounded-lg hover:opacity-90 transition font-semibold">
                        <i class="fas fa-plus mr-2"></i>워크샵 등록
                    </button>
                </div>

                <!-- Workshops Grid -->
                <div id="workshops-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="col-span-full text-center py-12 text-gray-500">
                        <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                        <p>데이터를 불러오는 중...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Classes Section -->
        <div id="section-classes" class="content-section hidden">
            <div class="fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-dark-slate">
                        <i class="fas fa-chalkboard-teacher text-sage mr-3"></i>원데이 클래스 관리
                    </h2>
                    <button onclick="openClassModal()" 
                        class="bg-sage text-white px-6 py-3 rounded-lg hover:opacity-90 transition font-semibold">
                        <i class="fas fa-plus mr-2"></i>클래스 등록
                    </button>
                </div>

                <!-- Classes Grid -->
                <div id="classes-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="col-span-full text-center py-12 text-gray-500">
                        <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                        <p>데이터를 불러오는 중...</p>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Product Modal -->
    <div id="product-modal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <div class="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center">
                    <h3 class="text-2xl font-bold text-gray-800">
                        <i class="fas fa-box mr-2"></i><span id="product-modal-title">제품 등록</span>
                    </h3>
                    <button onclick="closeProductModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                <form id="product-form" class="p-6" onsubmit="saveProduct(event)">
                    <input type="hidden" id="product-id">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">제품명 <span class="text-red-500">*</span></label>
                            <input type="text" id="product-name" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">컨셉 <span class="text-red-500">*</span></label>
                            <select id="product-concept" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage">
                                <option value="">선택</option>
                                <option value="symptom_care">증상 케어</option>
                                <option value="refresh">리프레시</option>
                            </select>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">가격 (원) <span class="text-red-500">*</span></label>
                                <input type="number" id="product-price" required min="0" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">재고 <span class="text-red-500">*</span></label>
                                <input type="number" id="product-stock" required min="0" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">설명</label>
                            <textarea id="product-description" rows="3" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage"></textarea>
                        </div>
                        <div>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="product-is-active" checked class="w-5 h-5 text-sage rounded">
                                <span class="text-sm font-semibold text-gray-700">판매중</span>
                            </label>
                        </div>
                    </div>
                    <div class="mt-6 flex space-x-3">
                        <button type="submit" class="flex-1 bg-sage text-white px-6 py-3 rounded-lg hover:opacity-90 font-semibold">
                            <i class="fas fa-save mr-2"></i>저장
                        </button>
                        <button type="button" onclick="closeProductModal()" class="flex-1 bg-gray-300 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-400 font-semibold">
                            <i class="fas fa-times mr-2"></i>취소
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script>
        console.log('==== ADMIN PAGE HTML LOADED ====');
        console.log('Script loading from:', '/static/admin-products.js?v=20251119003');
    </script>
    <script src="/static/admin-products.js?v=20251119003"></script>
</body>
</html>
