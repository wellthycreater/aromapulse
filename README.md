# 아로마펄스 시장 테스트 플랫폼 (Lean MVP)

## 🏢 회사 정보

**브랜드**: 아로마펄스 (AromaPulse)  
**운영사**: 웰씨코리아 (Wellthy Korea)  
**향후 법인**: (주)센펄스 (Senpulse Co., Ltd.) - 법인 설립 예정

## 🎯 프로젝트 개요

**목적**: 불면, 우울, 불안 등 스트레스 관련 증상에 관심이 있는 B2C 사용자와 오프라인 중심 로컬 향기 공방·소규모 업체(B2B)를 온라인으로 연결하는 시장 테스트 플랫폼

**특징**:
- 텍스트 중심 데이터 수집 및 분석
- Rule 기반 추천 시스템 (AI 없이 운영)
- 자사 블로그 중심 유입 및 리뷰 수집
- 증상케어 제품 vs 리프레시 제품 구분

## 🌐 접속 URL

### 프로덕션 (Cloudflare Pages) ✅
- **메인 URL**: https://aromapulse.pages.dev
- **로그인**: https://aromapulse.pages.dev/login
- **회원가입**: https://aromapulse.pages.dev/signup
- **예정 도메인**: https://aromapulse.kr (연결 예정)

### 개발 환경 (Sandbox)
- **Frontend**: https://3000-ixw6l6ek5pa4nw2e7gi09-c07dda5e.sandbox.novita.ai
- **API Health Check**: https://3000-ixw6l6ek5pa4nw2e7gi09-c07dda5e.sandbox.novita.ai/api/health

## 📋 현재 완료된 기능

### ✅ 핵심 기능
1. **회원 시스템 & OAuth 소셜 로그인**
   - B2C 사용자 (일반 스트레스형 / 직무 스트레스형)
   - B2B 사용자 (조향사 / 기업 / 가게)
   - 이메일/비밀번호 로그인
   - 네이버 소셜 로그인 ✅
   - 카카오 소셜 로그인 ✅
   - 구글 소셜 로그인 ✅
   - JWT 토큰 기반 인증
   - 다단계 회원가입 폼 (사용자 유형별 상세 정보 수집)

2. **제품 관리 시스템**
   - 증상케어 제품 (타사 공방)
     - 맞춤제작형 (상담 후 제작)
     - 완제품형 (즉시 구매 가능)
   - 리프레시 제품 (아로마펄스 자체 브랜드)
   - 상품 등록/수정/삭제 API
   - 재고 관리
   - 이미지 업로드 지원

3. **리뷰 시스템**
   - 자체 플랫폼 리뷰 작성
   - 블로그 댓글 수집 준비 완료
   - 수동 태깅 (감정/의도 분류)

4. **Rule 기반 추천 엔진**
   - 사용자 증상 + 지역 + 제품 타입 매칭
   - 추천 로그 자동 저장

5. **패치 신청 시스템**
   - 간단한 신청 폼
   - 상태 관리 (pending → approved → shipped → completed)

6. **BEFORE/AFTER 설문**
   - 스트레스 수준 측정 (1-10)
   - 수면 품질, 불안, 우울 레벨 추적

7. **관리자 기능**
   - 리뷰/댓글 수동 태깅
   - 상품 관리 (CRUD)
   - 패치 신청 관리
   - 대시보드 통계

8. **블로그 관리 시스템 (NEW v1.6.0)** ✅
   - 네이버 블로그 URL 입력을 통한 댓글 자동 수집
   - 실시간 댓글 크롤링 (시뮬레이션 모드 with fallback)
   - AI 댓글 분석 (감정, 사용자 타입, 의도, 키워드)
   - 구매 의도 댓글 자동 감지 및 챗봇 세션 생성
   - B2C/B2B 고객 자동 분류
   - **컨텍스트 기반 AI 응답**: 오일 사용 고객에게 추가 질문으로 정확한 니즈 파악
   - 블로그 포스트별 통계 대시보드
   - Admin 페이지 "블로그 관리" 탭 UI

## 🚀 블로그 댓글 수집 시스템 (v1.6.0)

### 기능 설명
- **실시간 댓글 크롤링**: 네이버 블로그 URL 입력 시 해당 포스트의 모든 댓글 자동 수집
- **네이버 댓글 API 활용 + 시뮬레이션 폴백**: 
  - 1차: 네이버 댓글 API 시도 (`apis.naver.com/commentBox`)
  - 2차: API 실패 시 실제 댓글 기반 시뮬레이션 데이터 생성
- **AI 자동 분석**:
  - 감정 분석 (positive, negative, neutral)
  - 사용자 유형 예측 (B2C, B2B) - 마사지/스파/고객 키워드 감지
  - 의도 파악 (구매의도, B2B문의, 가격문의, 문의, 긍정리뷰, 부정리뷰, 일반댓글)
  - 키워드 추출 (증상, 제품, 향료, 오일 종류 등)
- **인텔리전트 챗봇 자동 생성**: 
  - 구매 의도/B2B 문의 댓글 자동 감지
  - 맥락 기반 추가 질문 생성 (지역, 제품 형태, 사용 목적, 월 사용량 등)
  - B2B 고객: 마사지/스파 비즈니스 맞춤 응답
  - 지역 기반 공방 매칭 안내
- **통계 대시보드**: 블로그 포스트별 댓글 수, B2C/B2B 비율, 챗봇 세션 수 확인

### API 엔드포인트
```
POST /api/blog-reviews/crawl-from-url
{
  "url": "https://blog.naver.com/aromapulse/223879507099"
}

GET /api/blog-reviews/posts
- 블로그 포스트 목록 조회 (통계 포함)

GET /api/blog-reviews/posts/:post_id/comments
- 특정 포스트의 댓글 조회
```

### 테스트 방법
1. Admin 페이지 접속: https://3000-ixw6l6ek5pa4nw2e7gi09-c07dda5e.sandbox.novita.ai/admin-products
2. "블로그 관리" 탭 클릭
3. 네이버 블로그 URL 입력 (예: https://blog.naver.com/aromapulse/223879507099)
4. "댓글 수집 및 분석" 버튼 클릭
5. 수집 완료 후 통계 확인

### B2B 리드 응대 프로세스

**실제 댓글 예시**:
> "캐리어오일에 에센셜오일(베르가못, 라벤더)을 섞어서 목과 데콜테 마사지 해주고 있는데 손님 반응이 좋아요. 제품문의는 어디로 드리면 될까요"

**1단계: 자동 분석**
- 사용자 유형: `B2B` (키워드: "손님", "마사지")
- 의도: `B2B문의` (키워드: "제품문의")
- 키워드: `라벤더`, `베르가못`, `에센셜오일`, `캐리어오일`

**2단계: 챗봇 자동 생성 및 응답**
```
🏢 마사지/스파 비즈니스 고객님을 위한 맞춤 상담

보다 정확한 상담을 위해 몇 가지 여쭤봐도 될까요?

📋 추가 질문:
1️⃣ 지역: 어느 지역에서 운영하고 계신가요?
2️⃣ 필요하신 제품 형태:
   • 원료용 오일 (직접 블렌딩용)
   • 즉시 사용 가능한 완제품 (마사지 오일, 룸스프레이, 디퓨저)
   • 특정 제품 (어떤 제품인지 알려주세요)
3️⃣ 사용 목적: 직접 사용? 손님 서비스용? 판매용?
4️⃣ 선호 향: 라벤더, 베르가못 외 다른 향도 필요하신가요?
5️⃣ 월 사용량: 대략적인 월 사용량을 알려주시면 도움이 됩니다
```

**3단계: 운영자 액션**
1. 고객 응답 확인 후 지역 정보 파악
2. 니즈 분석:
   - **원료 오일 필요**: 해당 지역 근방 공방에서 원료 오일 공급
   - **완제품 필요**: 추가 질의를 통해 제품 형태 확인 후 공방 매칭
3. 지역 기반 공방 연결 및 납품 중개
4. 유사 제품 자사몰 등록 (향후 직접 판매)

### 비즈니스 가치
- **고객 인사이트**: 블로그 댓글을 통한 실제 고객 니즈 파악
- **리드 발굴**: 구매 의도가 있는 댓글 자동 감지 및 챗봇 연결
- **B2B/B2C 분류**: 비즈니스 고객(마사지/스파/미용실)과 개인 고객 자동 구분
- **인텔리전트 컨텍스트 인식**: 
  - 마사지/스파 비즈니스 고객 자동 감지
  - 지역, 제품 형태, 사용 목적, 월 사용량 등 필수 정보 수집
  - 지역 기반 공방 매칭 준비
- **효율적 응대**: 초기 정보 수집 자동화로 매니저 상담 시간 단축

### 실제 사용 예시

**입력 댓글:**
> "캐리어오일에 에센셜오일(베르가못, 라벤더)을 섞어서 목과 데콜테 마사지 해주고 있는데 손님 반응이 좋아요. 제품문의는 어디로 드리면 될까요"

**AI 분석 결과:**
- 사용자 유형: **B2B** (키워드: "손님", "마사지")
- 의도: **B2B문의** (키워드: "제품문의")
- 감정: **positive**
- 키워드: 라벤더, 베르가못, 에센셜오일, 캐리어오일

**생성된 챗봇 응답 (맥락 기반 추가 질문):**
```
🏢 마사지/스파 비즈니스 고객님을 위한 맞춤 상담

보다 정확한 상담을 위해 몇 가지 여쭤봐도 될까요?

📋 추가 질문:
1️⃣ 지역: 어느 지역에서 운영하고 계신가요? (제휴 공방 매칭을 위해 필요)
2️⃣ 필요하신 제품 형태:
   • 원료용 오일 (직접 블렌딩용)
   • 즉시 사용 가능한 완제품 (마사지 오일, 룸스프레이, 디퓨저)
   • 특정 제품 (어떤 제품인지 알려주세요)
3️⃣ 사용 목적: 직접 사용? 손님 서비스용? 판매용?
4️⃣ 선호 향: 라벤더, 베르가못
5️⃣ 월 사용량: 대략적인 월 사용량을 알려주시면 도움이 됩니다

→ 지역 기반 공방 매칭 및 맞춤 제안 제공 준비
```

## 🔄 향후 구현 예정

1. **블로그 RSS 자동 수집**
   - 네이버 블로그 (aromapulse) RSS 파싱
   - 주기적 포스트 수집

2. **프론트엔드 UI**
   - 회원가입/로그인 페이지
   - 제품 목록/상세 페이지
   - 리뷰 작성 페이지
   - 패치 신청 페이지
   - 관리자 대시보드

3. **이미지 업로드**
   - Cloudflare R2 연동 또는
   - 외부 이미지 스토리지 연동

## 🗄️ 데이터 아키텍처

### Database: Cloudflare D1 (SQLite)

**주요 테이블**:
- `users` - 회원 (B2C/B2B 구분, 증상, 지역)
- `products` - 제품 (증상케어/리프레시 구분, 맞춤/완제품)
- `workshops` - 공방/워크숍
- `reviews` - 자체 리뷰
- `blog_posts` - 블로그 포스트
- `blog_comments` - 블로그 댓글
- `patch_applications` - 패치 신청
- `surveys` - BEFORE/AFTER 설문
- `recommendation_logs` - 추천 로그

## 🚀 API 엔드포인트

### 인증 (Auth)
- `POST /api/auth/signup` - 회원가입 (이메일/비밀번호)
- `POST /api/auth/login` - 로그인
- `GET /api/auth/me/:id` - 사용자 정보 조회
- `GET /api/auth/naver` - 네이버 OAuth 시작
- `GET /api/auth/naver/callback` - 네이버 OAuth 콜백
- `GET /api/auth/kakao` - 카카오 OAuth 시작
- `GET /api/auth/kakao/callback` - 카카오 OAuth 콜백
- `GET /api/auth/google` - 구글 OAuth 시작
- `GET /api/auth/google/callback` - 구글 OAuth 콜백
- `POST /api/auth/create-admin` - 관리자 계정 생성 (비밀 키 필요)
- `GET /api/auth/admins` - 관리자 목록 조회

### 제품 (Products)
- `GET /api/products` - 제품 목록 (필터링 가능)
- `GET /api/products/:id` - 제품 상세
- `GET /api/products/recommend/:userId` - Rule 기반 추천

### 리뷰 (Reviews)
- `POST /api/reviews` - 리뷰 작성
- `GET /api/reviews` - 리뷰 목록
- `GET /api/reviews/:id` - 리뷰 상세
- `GET /api/reviews/blog-comments` - 블로그 댓글 목록

### 패치 (Patch)
- `POST /api/patch/apply` - 패치 신청
- `GET /api/patch/applications` - 신청 목록
- `GET /api/patch/applications/:id` - 신청 상세
- `POST /api/patch/survey` - 설문 제출
- `GET /api/patch/surveys` - 설문 조회

### 블로그 (Blog)
- `GET /api/blog/posts` - 블로그 포스트 목록
- `GET /api/blog/posts/:id` - 포스트 상세
- `POST /api/blog/collect-rss` - RSS 수집 (관리자)
- `POST /api/blog/collect-comments` - 댓글 수집 (관리자)

### 관리자 (Admin)
- `POST /api/admin/tag-review` - 리뷰 태깅
- `POST /api/admin/tag-comment` - 댓글 태깅
- `POST /api/admin/products` - 상품 등록
- `PUT /api/admin/products/:id` - 상품 수정
- `DELETE /api/admin/products/:id` - 상품 삭제
- `PUT /api/admin/patch-applications/:id/status` - 패치 신청 상태 변경
- `GET /api/admin/dashboard/stats` - 대시보드 통계

## 💾 샘플 데이터

데이터베이스에는 다음 샘플 데이터가 포함되어 있습니다:
- 테스트 사용자 4명 (B2C 2명, B2B 2명)
- 공방/워크숍 3곳
- 증상케어 제품 5개 (맞춤제작 2개, 완제품 3개)
- 리프레시 제품 6개 (현재 제조 중 2개, 준비 중 4개)
- 블로그 포스트 3개
- 블로그 댓글 4개
- 자체 리뷰 2개
- 패치 신청 2개
- 설문 2개

## 🛠️ 기술 스택

- **Framework**: Hono (Cloudflare Workers)
- **Runtime**: Cloudflare Pages
- **Database**: Cloudflare D1 (SQLite)
- **Language**: TypeScript
- **Build Tool**: Vite
- **Process Manager**: PM2 (개발 환경)
- **Deployment**: Wrangler CLI

## 📦 개발 환경 설정

### 필수 요구사항
- Node.js 18+
- npm
- wrangler CLI

### 로컬 개발

```bash
# 의존성 설치
npm install

# 데이터베이스 마이그레이션
npm run db:migrate:local

# 시드 데이터 삽입
npm run db:seed

# 빌드
npm run build

# 개발 서버 시작 (PM2)
npm run clean-port
pm2 start ecosystem.config.cjs

# 서버 상태 확인
pm2 list
pm2 logs aromapulse-webapp --nostream

# API 테스트
curl http://localhost:3000/api/health
```

### 데이터베이스 관리

```bash
# 로컬 데이터베이스 초기화
npm run db:reset

# 마이그레이션 적용 (로컬)
npm run db:migrate:local

# 마이그레이션 적용 (프로덕션)
npm run db:migrate:prod

# 데이터베이스 콘솔 (로컬)
npm run db:console:local

# 데이터베이스 콘솔 (프로덕션)
npm run db:console:prod
```

## 🚢 배포

### Cloudflare Pages 배포 ✅ 완료

**현재 배포 상태**: https://aromapulse.pages.dev

```bash
# 1. 프로젝트 빌드
npm run build

# 2. Cloudflare Pages 배포
export CLOUDFLARE_API_TOKEN="your-api-token"
npx wrangler pages deploy dist --project-name aromapulse

# 3. 환경 변수 설정 (이미 완료)
# - JWT_SECRET
# - NAVER_CLIENT_ID, NAVER_CLIENT_SECRET, NAVER_CALLBACK_URL
# - KAKAO_CLIENT_ID, KAKAO_CLIENT_SECRET, KAKAO_CALLBACK_URL
# - GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET, GOOGLE_CALLBACK_URL

# 4. 환경 변수 추가 (필요시)
echo "your-secret" | npx wrangler pages secret put SECRET_NAME --project-name aromapulse
```

### OAuth Callback URL 설정 필요

배포 후 각 OAuth 플랫폼에서 프로덕션 Callback URL을 등록해야 합니다:

**네이버 개발자센터**: https://developers.naver.com/apps
- Callback URL: `https://aromapulse.pages.dev/api/auth/naver/callback`
- 향후 도메인: `https://aromapulse.kr/api/auth/naver/callback`

**카카오 개발자센터**: https://developers.kakao.com/console
- Redirect URI: `https://aromapulse.pages.dev/api/auth/kakao/callback`
- 향후 도메인: `https://aromapulse.kr/api/auth/kakao/callback`
- 카카오 로그인 활성화 필요

**구글 클라우드 콘솔**: https://console.cloud.google.com/apis/credentials
- 승인된 리디렉션 URI: `https://aromapulse.pages.dev/api/auth/google/callback`
- 향후 도메인: `https://aromapulse.kr/api/auth/google/callback`

### D1 Database (향후 추가 예정)

현재는 D1 Database 없이 배포되었습니다. 데이터 저장이 필요한 경우:

```bash
# D1 Database 생성
npx wrangler d1 create aromapulse-production

# wrangler.jsonc에 database_id 추가 후
npm run db:migrate:prod
```

## 📊 비즈니스 모델

### B2C (개인 고객)
1. **일상 스트레스형**
   - 불면, 우울, 불안 증상 개선
   - 증상 기반 제품 추천
   - 지역 기반 공방 매칭

2. **직무 스트레스형**
   - 업무 관련 스트레스 관리
   - 집중력 향상
   - 번아웃 예방

### B2B (비즈니스)
1. **조향사 (파트너 제휴)**
   - 공동 제품 개발
   - 클래스 협업

2. **기업 (대량 납품/클래스)**
   - 직원 힐링 프로그램
   - 대량 납품
   - 기업 맞춤 클래스

3. **가게 (제품 문의)**
   - 매장 입점
   - 제품 공급

## 🎨 제품 컨셉

### 증상케어 제품 (타사 공방)
- **컨셉**: 전문성·신뢰 기반 폐쇄형
- **판매**: 자사 사이트에서만 (중개)
- **특징**: 
  - 맞춤제작형: 상담 설계 → 별도 제작 (고가)
  - 완제품형: 기존 보유 제품 (저가)

### 리프레시 제품 (아로마펄스 자체 브랜드)
- **컨셉**: 감성·취향 기반 공개형
- **판매**: 오픈 마켓 진출 가능
- **특징**:
  - 현재 제조 중: 섬유향수, 룸스프레이 (30ml)
  - 준비 중: 섬유탈취제, 디퓨저, 캔들, 향수

## 📈 데이터 수집 전략

1. **블로그 중심 유입**
   - 네이버 블로그 (aromapulse) 콘텐츠 양산
   - RSS 자동 수집

2. **댓글/리뷰 수집**
   - 블로그 댓글 크롤링
   - 자체 플랫폼 리뷰 작성

3. **텍스트 패턴 분석**
   - 키워드 추출 ("납품", "워크숍" 등)
   - B2C/B2B 자동 분류

4. **수동 태깅**
   - 감정 (긍정/부정/중립)
   - 의도 (관심/문의/체험후기/구매의향)

5. **행동 추적**
   - 유입 경로 (블로그, 인스타, 카페 등)
   - 전환율 측정 (리뷰 → 설문 → 패치 신청)

## 🔮 AI 확장 계획 (향후)

현재는 **AI 없이** Rule 기반으로 운영하지만, 데이터가 충분히 쌓이면:
1. GPT API로 텍스트 감정/의도 자동 태깅
2. Embedding 기반 제품 추천
3. 사용자 군집화 (K-means)
4. 다음 행동 예측 모델

## 📝 운영 방침

- **초기 3개월**: 수동 운영 + 데이터 수집
- **AI 도입**: 데이터 검증 후
- **비용 최소화**: Cloudflare 무료 플랜 활용
- **점진적 확장**: 시장 반응 확인 후

## 🔒 보안 및 개인정보

- HTTPS 통신
- 개인정보보호법 준수
- 건강정보 암호화 저장 (향후)
- 접근 권한 관리

## 📞 연락처

- **블로그**: https://blog.naver.com/aromapulse
- **이메일**: admin@aromapulse.co.kr (예정)

---

**Last Updated**: 2025-11-14
**Version**: 1.5.0 (Blog Management System)
**Status**: ✅ Cloudflare Pages 배포 완료
**Production URL**: https://035a2253.aromapulse.pages.dev
**Domain**: www.aromapulse.kr
**Dev URL**: https://3000-ixw6l6ek5pa4nw2e7gi09-c07dda5e.sandbox.novita.ai

## 🔄 사이트 구조 재정의 (v1.4.0)

### 🌐 **웹사이트** (www.aromapulse.kr)
**목적**: 로컬 공방 제품 쇼핑몰 전용

#### B2C (일반 개인 고객)
- ✅ 쇼핑 (로컬 공방 제품 구매)
- ✅ 대시보드
- ❌ 워크샵 메뉴 제거 → AI 챗봇으로 통합
- ❌ AI 상담 메뉴 제거 → 블로그 임베드로 통합

#### B2B (기업 고객)
- ✅ 쇼핑 (로컬 공방 제품 - 대량/소량 모두 가능)
- ✅ 워크샵 메뉴 표시 (B2B 전용)
- ✅ 대시보드
- ❌ AI 상담 메뉴 제거 → 블로그 임베드로 통합

### 🤖 **AI 챗봇** (블로그 임베드)
**위치**: https://blog.naver.com/aromapulse

#### B2C 문의
- 제품 상담
- 증상별 추천
- 구매 안내

#### B2B 문의
- 원데이 클래스/워크샵 문의
- 파트너사 제휴 (공방)
- 오프라인 매장 (에스테틱, 미용실, 웰니스 가게 등) 제품 문의
- 대량 납품 문의
- 기능성/효능성 제품 문의
- 비즈니스 협업 문의

### 🆕 최신 업데이트 (v1.4.0)

**메뉴 구조 최적화** ✅
1. **워크샵 메뉴 가시성 제어**
   - B2C 사용자: 워크샵 메뉴 숨김
   - B2B 사용자: 워크샵 메뉴 표시
   - 비로그인: 워크샵 메뉴 숨김

2. **AI 상담 메뉴 제거**
   - 사이트 메뉴에서 완전 제거
   - 블로그 임베드 챗봇으로 통합
   - `/chatbot` URL은 직접 접속 시 유지

3. **대시보드 개선**
   - B2C: 제품 상담 안내만 표시
   - B2B: 비즈니스 파트너십 안내 표시
   - 워크샵 관련 함수 제거

4. **사용자용 쇼핑 페이지 추가** ✅
   - `/shop` - 공개 제품 목록
   - 증상케어/리프레시 탭 구분
   - 장바구니 기능 준비
   - 공방 정보 및 제품 정보 표시

**이전 업데이트 (v1.3.0)** - 리프레시 제품 유형 시스템
**이전 업데이트 (v1.2.0)** - 로컬 공방 정보 시스템

## 🔮 AI 확장 계획 (향후)

현재는 **AI 없이** Rule 기반으로 운영하지만, 데이터가 충분히 쌓이면:
1. GPT API로 텍스트 감정/의도 자동 태깅
2. Embedding 기반 제품 추천
3. 사용자 군집화 (K-means)
4. 다음 행동 예측 모델

## 📝 운영 방침

- **초기 3개월**: 수동 운영 + 데이터 수집
- **AI 도입**: 데이터 검증 후
- **비용 최소화**: Cloudflare 무료 플랜 활용
- **점진적 확장**: 시장 반응 확인 후

## 🔒 보안 및 개인정보

- HTTPS 통신
- 개인정보보호법 준수
- 건강정보 암호화 저장 (향후)
- 접근 권한 관리

## 📞 연락처

- **블로그**: https://blog.naver.com/aromapulse
- **이메일**: admin@aromapulse.co.kr (예정)

### 챗봇 (Chatbot) 🤖
- `POST /api/chatbot/session/start` - 새 챗봇 세션 시작
- `POST /api/chatbot/message` - 메시지 전송 및 AI 응답
- `GET /api/chatbot/session/:id/messages` - 대화 내역 조회
- `POST /api/chatbot/predict-behavior` - 사용자 행동 예측
- `POST /api/chatbot/update-interest-profile` - 관심사 프로필 업데이트
- `POST /api/chatbot/track-conversion` - 회원가입 전환 추적 (클릭 시점)
- `POST /api/chatbot/track-signup-conversion` - 회원가입 완료 추적
- `GET /api/chatbot/conversion-stats` - 전환율 통계 조회

### 블로그 리뷰 분석 (Blog Reviews) 📊
- `POST /api/blog-reviews/posts` - 블로그 포스트 등록
- `GET /api/blog-reviews/posts` - 포스트 목록 조회
- `POST /api/blog-reviews/comments` - 댓글 등록 및 AI 분석
- `GET /api/blog-reviews/comments` - 댓글 목록 조회
- `GET /api/blog-reviews/leads` - 리드 발견 (B2B/B2C)
- `GET /api/blog-reviews/analysis/sentiment` - 감정 분석 통계
- `GET /api/blog-reviews/analysis/keywords` - 키워드 추출

### 관리자 제품 관리 (Admin Products) 🛒
- `POST /api/admin-products` - 제품 등록 (이미지 업로드 + **로컬 공방 정보** 포함)
- `GET /api/admin-products` - 제품 목록 조회
- `PUT /api/admin-products/:id` - 제품 수정
- `DELETE /api/admin-products/:id` - 제품 삭제

**제품 등록/수정 시 포함 가능한 로컬 공방 정보**:
- `workshop_name` - 공방명 (예: 향기로운 하루 공방)
- `workshop_location` - 지역 (서울, 경기, 부산 등 17개 선택)
- `workshop_address` - 상세 주소
- `workshop_contact` - 연락처 (전화번호)

## 🎯 최근 업데이트 (2025-11-13)

### ✅ 완료된 작업
1. **AI 챗봇 시스템 구축**
   - B2B/B2C 자동 감지 알고리즘
   - Intent/Sentiment/Entity 분석
   - 행동 예측 및 제품 추천
   - 프로덕션 도메인 연동 (www.aromapulse.kr)
   - **회원가입 유도 플로우 추가** ✅
   - **상담 종료 기능** ✅

2. **블로그 리뷰 분석 시스템**
   - 네이버 블로그 댓글 수집 및 AI 분석
   - 키워드 추출 및 리드 발견
   - 관리자 대시보드

3. **관리자 제품 관리**
   - 대표 이미지 + 상세 이미지 업로드
   - Cloudflare R2 스토리지 연동
   - 제품 CRUD 완성
   - **로컬 공방 정보 등록** ✅
     - 공방명, 지역, 상세 주소, 연락처
     - 제품 카드에 공방 정보 표시
   - **리프레시 제품 유형 및 용량 관리** ✅
     - 제품 유형: 섬유 향수 ✅, 룸 스프레이 ✅, 섬유 탈취제 ⏳, 디퓨저 ⏳, 캔들 ⏳, 향수 ⏳
     - 용량: 30ml ✅, 50ml ⏳, 100ml ⏳
     - 현재 등록 가능: 섬유 향수 30ml, 룸 스프레이 30ml

4. **블로그 임베드 도구**
   - 버튼 생성기: https://www.aromapulse.kr/static/blog-button-generator
   - 실제 예시: https://www.aromapulse.kr/static/blog-example
   - 임베드 가이드: https://www.aromapulse.kr/static/blog-embed-guide

### 🎉 프로덕션 도메인 설정 완료
- **메인 도메인**: www.aromapulse.kr
- **챗봇 회원가입 유도**: B2B → www.aromapulse.kr/signup?type=B2B
- **챗봇 회원가입 유도**: B2C → www.aromapulse.kr/signup?type=B2C
- **모든 블로그 버튼 링크**: 프로덕션 도메인으로 업데이트 완료 ✅

### 🤖 AI 챗봇 회원가입 플로우

**사용자 여정**:
1. 블로그 또는 사이트에서 챗봇 시작
2. AI가 대화를 통해 사용자 타입 자동 감지 (B2B/B2C)
3. 구매/서비스 의도 감지 시 **회원가입 혜택 자동 안내**:
   - **B2C**: 첫 구매 10% 할인 + 적립금 5% + 무료 배송
   - **B2B**: 대량 구매 20% 할인 + 전담 매니저 + 샘플 무료 제공
4. 사용자 선택:
   - **서비스 이용 원함** → 회원가입 페이지로 이동 (전환 추적)
   - **이용 안 함** → 상담 종료 버튼 클릭하여 나가기

**전환 추적**:
- 회원가입 버튼 클릭 시 `is_converted` 플래그 자동 업데이트
- B2B/B2C별 전환율 통계 제공
- 대시보드에서 실시간 전환율 모니터링 가능

**구현 위치**:
- 챗봇 페이지: `/chatbot` (https://www.aromapulse.kr/chatbot)
- 위젯 임베드: `/static/chatbot-widget.html`
- 블로그 버튼: `/static/blog-button-generator`

### 👤 관리자 계정 시스템

**관리자 역할**:
- `user` - 일반 사용자 (기본값)
- `admin` - 관리자 (제품 관리, 주문 관리, 통계 조회)
- `super_admin` - 최고 관리자 (향후 확장)

**관리자 계정 생성 방법**:
1. `/create-admin` 페이지 접속
2. 이메일, 비밀번호, 이름, 연락처 입력
3. **관리자 비밀 키** 입력: `aromapulse-admin-2025`
4. 계정 생성 완료

**API로 관리자 생성**:
```bash
curl -X POST https://your-domain/api/auth/create-admin \
  -H "Content-Type: application/json" \
  -d '{
    "email": "admin@aromapulse.kr",
    "password": "your-secure-password",
    "name": "관리자 이름",
    "phone": "010-1234-5678",
    "secret_key": "aromapulse-admin-2025"
  }'
```

**기본 관리자 계정**:
- 이메일: `admin@aromapulse.kr`
- 비밀번호: (초기 설정 시 지정)
- 역할: `admin`

**관리자 페이지 접근**:
- 제품 관리: `/admin-products`
- 블로그 리뷰 분석: `/admin/blog-reviews`

리: `/admin-products`
- 블로그 리뷰 분석: `/admin/blog-reviews`


## 🆕 최신 업데이트 (v1.5.0) - 블로그 관리 시스템

### ✅ 완료된 작업 (2025-11-14)

**블로그 관리 탭 추가** (관리자 페이지에 통합)
1. **관리자 페이지 개선**
   - `/admin-products`에 "블로그 관리" 탭 추가
   - 제품 관리와 블로그 관리를 한 페이지에서 처리
   - 탭 전환으로 간편한 관리 UI

2. **블로그 URL 입력 기반 댓글 수집**
   - 네이버 블로그 게시물 URL 입력
   - 자동 댓글 크롤링 (현재 시뮬레이션 모드)
   - 실시간 댓글 분석 및 통계

3. **자동 AI 분석**
   - **감정 분석**: positive, negative, neutral
   - **사용자 타입 예측**: B2C (개인), B2B (기업)
   - **의도 분석**: 구매의도, 문의, B2B문의, 가격문의, 긍정리뷰, 부정리뷰, 일반댓글
   - **키워드 추출**: 증상, 제품, 향, 용도 자동 추출

4. **구매 의도 댓글 → 챗봇 세션 자동 생성**
   - 구매의도, 문의, B2B문의, 가격문의 댓글 자동 감지
   - 챗봇 세션 자동 생성 및 AI 응답 생성
   - 댓글 작성자를 위한 맞춤형 상담 준비

5. **블로그 게시물 통계 대시보드**
   - 등록된 게시물 목록
   - 게시물별 댓글 수, 구매 의도 댓글 수
   - B2C/B2B 고객 분포
   - 생성된 챗봇 세션 수

### 📋 블로그 관리 API 엔드포인트

**블로그 댓글 수집 및 분석**:
- `POST /api/blog-reviews/crawl-from-url` - 블로그 URL에서 댓글 자동 수집 및 분석
- `GET /api/blog-reviews/posts` - 등록된 블로그 게시물 목록 (통계 포함)
- `GET /api/blog-reviews/posts/:post_id/comments` - 특정 게시물의 댓글 목록

**현재 응답 예시** (시뮬레이션 모드):
```json
{
  "message": "댓글 수집 및 분석 완료",
  "post_id": "223921529276",
  "total_comments": 5,
  "purchase_intent_count": 3,
  "b2c_count": 3,
  "b2b_count": 2,
  "chatbot_sessions_created": 3,
  "note": "현재는 시뮬레이션 모드입니다."
}
```

### 🎯 블로그 관리 사용 방법

**관리자 페이지 접속**:
1. `/admin-products`로 이동 (관리자 로그인 필요)
2. "블로그 관리" 탭 클릭

**블로그 댓글 수집**:
1. 네이버 블로그 게시물 URL 입력
   - 예: `https://blog.naver.com/aromapulse/223921529276`
2. "댓글 수집 및 분석" 버튼 클릭
3. 자동 분석 완료 알림 확인:
   - 총 댓글 수
   - 구매 의도 댓글 수
   - B2C/B2B 고객 분포
   - 생성된 챗봇 세션 수

**등록된 게시물 확인**:
- 게시물 목록에서 각 게시물의 통계 확인
- "게시물 보기" 버튼으로 네이버 블로그 이동
- "댓글 보기" 버튼으로 수집된 댓글 상세 보기

### 🔮 향후 개선 계획

1. **네이버 블로그 API 연동**
   - 현재: 시뮬레이션 더미 데이터 생성
   - 향후: 실제 네이버 블로그 댓글 크롤링
   - 네이버 오픈 API 또는 웹 크롤링 기술 적용

2. **자동 주기적 수집**
   - 일일 자동 댓글 수집
   - 새 댓글 알림 시스템
   - 실시간 댓글 모니터링

3. **고급 분석 기능**
   - 트렌드 분석 (시간대별, 키워드별)
   - 고객 여정 추적
   - ROI 분석 (블로그 → 댓글 → 챗봇 → 회원가입)

### 💡 비즈니스 가치

**자동화된 리드 발굴**:
- 블로그 댓글에서 잠재 고객 자동 감지
- 구매 의도 고객에게 즉시 챗봇 상담 제공
- B2C/B2B 구분으로 맞춤형 마케팅

**데이터 기반 의사결정**:
- 고객 관심사 파악 (키워드 분석)
- 제품 피드백 자동 수집
- 시장 반응 실시간 모니터링

**운영 효율화**:
- 수동 댓글 관리 → 자동 수집 및 분석
- 잠재 고객 놓치지 않고 자동 응대
- 관리자 대시보드에서 모든 정보 통합 관리

---

## 🆕 최신 업데이트 (v1.6.0) - 수동 댓글 입력 시스템 (하이브리드 전략)

### ✅ 완료된 작업 (2025-11-15)

**수동 댓글 입력 기능 추가** (하이브리드 접근: 수동 + 크롤링)
1. **UI 개선**
   - 블로그 포스트 카드에 "댓글 추가" 버튼 추가
   - 수동 댓글 입력 모달 (작성자명, 내용, 날짜 선택)
   - AI 분석 결과 실시간 표시 (이모지 포함)
   - 자동 폼 리셋 기능

2. **백엔드 API** (`/api/blog-reviews/comments/manual`)
   - 수동 댓글 입력 및 저장
   - AI 자동 분석 (감정, 사용자 타입, 의도, 키워드)
   - B2B/구매의도 댓글 → 챗봇 세션 자동 생성
   - 통계 실시간 업데이트

3. **중복 제거 로직 개선**
   - B2B 리드 목록 중복 제거 시 최신 항목 우선 표시
   - `ORDER BY created_at DESC, id DESC` 정렬로 정확도 향상

### 🎯 하이브리드 전략 (Manual + Crawling)

**현재 단계**: 수동 입력 중심 운영
- 블로그 댓글을 관리자가 직접 입력
- 법적 안전성 보장 (크롤링 리스크 없음)
- 초기 데이터 수집 및 시스템 검증

**향후 확장**: 크롤링 서버 추가
- 사업 규모 확대 시 별도 크롤링 서버 구축
- Puppeteer + Proxy 활용
- 수동/자동 병행 운영

### 📋 수동 댓글 입력 사용 방법

1. **관리자 페이지 접속**
   - `/admin-products`로 이동
   - "블로그 관리" 탭 클릭

2. **댓글 추가**
   - 블로그 포스트 카드에서 "댓글 추가" 버튼 클릭
   - 작성자명, 댓글 내용 입력
   - (선택) 작성 날짜 지정
   - "댓글 추가" 버튼 클릭
   - 여러 개의 댓글을 추가할 수 있습니다

3. **AI 분석 결과 확인**
   - 감정: 긍정😊/부정😔/중립😐
   - 사용자 타입: B2B/B2C/일반 고객
   - 의도: 구매의도, B2B문의, 가격문의, 일반댓글 등
   - 키워드: 자동 추출된 주요 키워드
   - 챗봇 세션 자동 생성 여부

4. **리드 확인**
   - B2B 문의 댓글의 경우 "B2B 리드 보기" 버튼으로 즉시 확인
   - 챗봇 페이지에서 자동 생성된 상담 세션 확인

### 💡 실제 사용 예시

**입력 댓글**:
```
작성자: 여행에 힐링을 더하다
내용: 캐리어오일에 에센셜오일(베르가못, 라벤더)을 섞어서 목과 데콜테 마사지 해주고 있는데 손님 반응이 좋아요. 제품문의는 어디로 드리면 될까요
```

**AI 분석 결과**:
```
✅ 댓글 추가 완료!

📝 작성자: 여행에 힐링을 더하다
📊 AI 분석 결과:
  - 감정: 긍정😊
  - 사용자 타입: B2B
  - 의도: B2B문의
  - 키워드: 라벤더, 베르가못, 에센셜오일, 캐리어오일

🤖 챗봇 세션이 자동으로 생성되었습니다!
```

**자동 생성된 챗봇 응답**:
```
🏢 마사지/스파 비즈니스 고객님을 위한 맞춤 상담

댓글 내용을 보니 손님께 마사지/케어 서비스를 제공하시는 비즈니스를 운영하고 계신 것 같습니다.

📋 추가 질문:
1️⃣ 지역: 어느 지역에서 운영하고 계신가요?
2️⃣ 필요하신 제품 형태:
   • 원료용 오일 (직접 블렌딩용)
   • 즉시 사용 가능한 완제품
3️⃣ 사용 목적: 직접 사용? 손님 서비스용? 판매용?
4️⃣ 선호 향: 라벤더, 베르가못 외 다른 향도 필요하신가요?
5️⃣ 월 사용량: 대략적인 월 사용량을 알려주시면 도움이 됩니다
```

### 🔧 기술적 개선사항

1. **API 응답 구조 개선**
   - `analysis` 객체로 분석 결과 구조화
   - 키워드 배열 형식으로 반환
   - 챗봇 세션 생성 여부 명확히 표시

2. **UI/UX 개선**
   - 이모지를 활용한 직관적인 결과 표시
   - 모달 닫을 때 자동 폼 리셋
   - 더 명확한 성공 메시지

3. **데이터 정확도 개선**
   - 중복 제거 시 최신 항목 우선 표시
   - `ORDER BY created_at DESC, id DESC` 정렬
   - 시뮬레이션 댓글의 동일 timestamp 문제 해결

### 📊 테스트 결과

**테스트 시나리오 1: B2B 문의 댓글**
- ✅ 댓글 추가 성공
- ✅ AI 분석 정확 (B2B, 긍정, B2B문의)
- ✅ 챗봇 세션 자동 생성
- ✅ B2B 리드 목록에 정확히 표시
- ✅ 통계 업데이트 (댓글 수 4→6)

**테스트 시나리오 2: 일반 댓글**
- ✅ 댓글 추가 성공
- ✅ AI 분석 정확 (일반 고객, 긍정, 일반댓글)
- ✅ 챗봇 세션 미생성 (의도대로)
- ✅ 키워드 없음 (일반 인사 댓글)

**테스트 시나리오 3: 구매의도 댓글**
- ✅ 댓글 추가 성공
- ✅ AI 분석 정확 (B2C, 긍정, 구매의도)
- ✅ 챗봇 세션 자동 생성
- ✅ 라벤더 키워드 추출

### 🎯 비즈니스 가치

**법적 안전성**:
- 네이버 블로그 API "Wrong ticket" 오류 회피
- 크롤링 법적 리스크 없음
- 자사 블로그 댓글만 수동 입력

**데이터 품질**:
- 관리자가 검증한 실제 댓글만 입력
- 스팸/광고 댓글 자동 필터링
- AI 분석 정확도 향상

**확장성**:
- 현재: 수동 입력으로 시스템 검증
- 향후: 크롤링 서버 추가 시 병행 운영 가능
- 점진적 자동화 확장 전략

### 🔮 로드맵

**Phase 1: 수동 입력 (현재)** ✅
- 블로그 댓글 수동 입력
- AI 분석 자동화
- 챗봇 자동 생성
- 데이터 수집 및 검증

**Phase 2: 하이브리드 (3개월 후)**
- 수동 입력 유지
- 크롤링 서버 추가 (선택적 사용)
- 수동/자동 병행 운영

**Phase 3: 완전 자동화 (6개월 후)**
- 크롤링 서버 메인 운영
- 수동 입력은 예외 케이스만
- 실시간 댓글 모니터링

---

---

## 🆕 최신 업데이트 (v1.6.2) - 다중 댓글 지원 (2025-11-15)

### ✅ 변경사항

**게시물당 여러 댓글 추가 가능**
1. **제한 해제**
   - 이전 버전(v1.6.1)의 "게시물당 1개 제한" 기능 제거
   - 한 게시물에 여러 개의 댓글을 자유롭게 추가 가능
   - 실제 네이버 블로그 댓글 수와 동일하게 관리 가능

2. **데이터베이스 정리**
   - 기존 중복 댓글 정리 완료
   - 각 게시물의 `comment_count` 정확성 확보
   - 깔끔한 상태에서 다시 시작

3. **사용 방법**
   - 동일 게시물에 여러 댓글 연속 추가 가능
   - 날짜 지정 가능 (시간순 정렬)
   - AI 분석은 각 댓글마다 독립적으로 수행

### 🎯 사용 시나리오

**정상 케이스**:
```
1. 게시물 A 선택 → 댓글 1 입력 → 성공 ✅
2. 게시물 A 선택 → 댓글 2 입력 → 성공 ✅
3. 게시물 A 선택 → 댓글 3 입력 → 성공 ✅
```

### 💡 비즈니스 가치

- **유연성**: 실제 블로그 댓글 수만큼 자유롭게 추가
- **정확성**: 네이버 블로그와 동일한 댓글 수 관리
- **분석 품질**: 더 많은 데이터로 정확한 AI 분석

---

---

## 📊 현재 데이터 현황 (2025-11-15)

### ✅ 등록된 블로그 게시물 (5개)

| 게시물 ID | 제목 | 댓글 수 |
|---------|------|---------|
| 223858923513 | 아로마테라피 효과, 어떤 오일이 감정 회복에 좋을까? | 0 |
| 223846281454 | 스트레스 해소 방법 찾는다면? 향기로 힐링하세요. | 2 |
| 223879463761 | 유칼립투스 오일 사용법 가이드, 천연 항균 효과로 일상에 건강 더하기 | 2 |
| 223871221945 | 페퍼민트 오일 사용법 총정리! 두통부터 집중력 향상까지 활용법 공개 | 3 |
| 223879507099 | 에센셜 오일 종류별 효능 총정리! 수면, 스트레스, 면역력까지 한눈에 | 4 |

### 📈 댓글 통계

- **총 댓글 수**: 11개
- **댓글 있는 게시물**: 4개
- **B2C 고객 댓글**: 0개
- **B2B 고객 댓글**: 1개
- **일반 댓글**: 10개

### 💡 AI 분류 정확도

- **단순 인사말**: 일반(null)로 정확히 분류
- **구매 의도 있는 댓글**: B2C/B2B로 자동 분류
- **감정 분석**: positive/negative/neutral 자동 태깅

---

---

## 🆕 최신 업데이트 (v1.7.0) - E-Commerce & Order Management (2025-11-15)

### ✅ 완료된 작업

**1. 사용자용 쇼핑몰 구축** ✅
- `/shop` - 고객용 제품 쇼핑 페이지
- `/checkout` - 주문/결제 페이지
- `/order-complete.html` - 주문 완료 페이지
- **장바구니 기능**:
  - LocalStorage 기반 장바구니 저장
  - 수량 변경 및 삭제
  - 실시간 금액 계산
- **Daum Postcode API 연동**:
  - 우편번호 및 주소 검색
  - 상세주소 입력

**2. 주문 관리 시스템** ✅
- **데이터베이스 스키마**:
  - `orders` 테이블: 주문 정보, 배송 정보, 결제 정보
  - `order_items` 테이블: 주문 상품 상세
- **주문 상태 관리**:
  - `payment_status`: pending → paid → refunded
  - `order_status`: pending → confirmed → preparing → shipped → delivered → cancelled
- **API 엔드포인트**:
  - `POST /api/orders/create` - 주문 생성
  - `GET /api/orders/:order_number` - 주문 조회
  - `GET /api/orders/admin/list` - 관리자 주문 목록
  - `GET /api/orders/admin/stats` - 주문 통계
  - `GET /api/orders/admin/:id` - 주문 상세 조회
  - `PUT /api/orders/admin/:id/payment-status` - 결제 상태 변경
  - `PUT /api/orders/admin/:id/order-status` - 주문 상태 변경
  - `PUT /api/orders/admin/:id/shipping` - 배송 정보 업데이트
  - `PUT /api/orders/admin/:id/memo` - 관리자 메모 저장

**3. 관리자 주문 관리 페이지** ✅
- `/static/admin-orders.html` - 주문 관리 대시보드
- **기능**:
  - 주문 목록 조회 (필터링, 검색, 정렬)
  - 주문 상세 보기 (고객 정보, 주문 상품, 결제 정보)
  - 결제 상태 변경 (결제 대기 → 결제 완료 → 환불)
  - 주문 상태 변경 (주문 접수 → 주문 확인 → 상품 준비중 → 배송중 → 배송 완료)
  - 배송 정보 입력 (택배사, 운송장 번호)
  - 관리자 메모 작성
  - 통계 대시보드 (전체 주문, 결제 대기, 결제 완료, 배송중, 배송 완료)

**4. 토스페이먼츠(Toss Payments) 결제 시스템** ✅
- **결제 위젯 SDK 연동**:
  - 토스페이먼츠 SDK v2 적용
  - 실시간 결제 수단 선택 (카드, 계좌이체, 가상계좌, 휴대폰)
  - 이용약관 동의 UI 자동 렌더링
- **결제 프로세스**:
  1. 고객이 체크아웃 페이지에서 주문 정보 입력
  2. 토스 결제 위젯으로 결제 수단 선택 및 결제 진행
  3. 토스에서 결제 완료 후 success URL로 리다이렉트
  4. 백엔드에서 토스 API로 결제 승인 요청 및 검증
  5. 주문 생성 및 결제 정보 저장 (`payment_status='paid'`, `order_status='confirmed'`)
  6. 재고 자동 차감
  7. 주문 완료 페이지 표시
- **결제 실패 처리**:
  - 결제 취소 시 fail URL로 리다이렉트
  - 실패 사유 자동 표시 및 재시도 안내
- **보안**:
  - HTTPS 통신
  - 결제 승인 시 서버 측 검증 (Amount 위변조 방지)
  - 토스페이먼츠 시크릿 키 환경 변수 관리

**5. 제품 검색 및 필터링** ✅
- 관리자 제품 관리 페이지에 검색/필터 기능 추가
- **기능**:
  - 제품명 검색
  - 가격 범위 필터 (3만원 이하, 3~5만원, 5~10만원, 10만원 이상)
  - 정렬 옵션 (최신순, 오래된순, 가격 낮은순/높은순, 이름순)

**6. 대시보드 통계 기간 필터** ✅
- 관리자 대시보드에 기간별 필터 추가
- **기간 옵션**:
  - 오늘
  - 이번 주
  - 이번 달
  - 전체

### 📋 주문 관리 워크플로우

**고객 주문 프로세스** (완전 자동화):
1. 쇼핑몰에서 제품 선택 → 장바구니 추가
2. 결제하기 버튼 클릭 → 주문/결제 페이지 이동
3. 고객 정보 입력 (이름, 이메일, 전화번호, 주소, 배송 메시지)
4. 토스 결제 위젯에서 결제 수단 선택 (카드, 계좌이체, 가상계좌 등)
5. 결제하기 버튼 클릭 → 토스페이먼츠 결제 진행
6. 결제 완료 시:
   - 백엔드에서 토스 API로 결제 승인 및 검증
   - 주문 자동 생성 (`payment_status='paid'`, `order_status='confirmed'`)
   - 재고 자동 차감
   - 주문 완료 페이지 표시 (주문번호, 결제 금액, 결제 방법)
7. 결제 실패 시:
   - 결제 실패 페이지로 리다이렉트
   - 실패 사유 자동 표시 (카드 한도 초과, 잔액 부족 등)
   - 재시도 버튼 제공

**관리자 주문 처리 프로세스**:
1. 관리자 주문 관리 페이지 접속 (`/static/admin-orders.html`)
2. 새 주문 확인 (결제 완료 상태 - 자동)
3. 주문 상세 보기 → 고객 정보 및 주문 내역 확인
4. 상품 준비 → "상품 준비중" 버튼 클릭
5. 배송 시작 → "배송 시작" 버튼 클릭
   - 택배사 선택 (CJ대한통운, 우체국택배, 한진택배 등)
   - 운송장 번호 입력
   - `order_status='shipped'`로 변경
6. 배송 완료 확인 → "배송 완료" 버튼 클릭

### 🎯 토스페이먼츠 결제 시스템

**선택 이유**:
- 페이업(Payup)은 일반적인 결제 API를 제공하지 않음 (수동 링크 생성 방식)
- 토스페이먼츠는 완전한 API 및 SDK 제공
- 국내 대표 결제 게이트웨이로 안정성과 신뢰성 보장

**기술 스택**:
- **Frontend**: 토스페이먼츠 SDK v2 (결제 위젯)
- **Backend**: 토스페이먼츠 Payments API (결제 승인)
- **개발 환경**: 테스트 키 사용
- **운영 환경**: 라이브 키로 교체 필요

**지원 결제 수단**:
- 신용카드
- 계좌이체
- 가상계좌
- 휴대폰 결제
- 간편결제 (토스페이, 네이버페이, 카카오페이 등)

**장점**:
- 완전 자동화된 결제 프로세스
- 실시간 결제 승인 및 검증
- 결제 실패 시 자동 재시도 안내
- 보안 강화 (서버 측 검증)
- 다양한 결제 수단 지원

**테스트 방법**:
1. 테스트 카드 정보:
   - 카드번호: 5570-0000-0000-0001
   - 유효기간: 임의의 미래 날짜
   - CVC: 임의의 3자리 숫자
2. 테스트 환경에서 실제 결제 없이 승인 가능
3. 운영 전환 시 라이브 키로 교체

### 🛠️ 기술 스택 업데이트

- **Frontend**: Vanilla JavaScript (장바구니, 주문 폼)
- **Backend**: Hono (TypeScript)
- **Database**: Cloudflare D1 (orders, order_items 테이블)
- **External APIs**:
  - Daum Postcode API (주소 검색)
  - 토스페이먼츠 SDK v2 (결제 위젯)
  - 토스페이먼츠 Payments API (결제 승인)

### 📊 주문 데이터베이스 스키마

**orders 테이블**:
- `order_number` - 주문번호 (ORDYYYYMMDDXXXXXX)
- `customer_*` - 고객 정보 (이름, 이메일, 전화번호, 주소)
- `*_amount` - 금액 정보 (상품 금액, 배송비, 할인, 최종 금액)
- `payment_status` - 결제 상태 (pending, paid, failed, cancelled, refunded)
- `order_status` - 주문 상태 (pending, confirmed, preparing, shipped, delivered, cancelled)
- `delivery_*` - 배송 정보 (택배사, 운송장 번호, 배송 메시지)
- `admin_memo` - 관리자 메모
- `*_at` - 타임스탬프 (주문일시, 결제일시, 배송일시, 배송완료일시, 취소일시)

**order_items 테이블**:
- `order_id` - 주문 ID (FK)
- `product_id` - 제품 ID (FK)
- `product_*` - 제품 정보 스냅샷 (이름, 컨셉, 카테고리, 용량)
- `quantity` - 수량
- `unit_price` - 단가
- `total_price` - 총액

### 🔮 향후 개선 계획

1. **이메일 자동 발송**
   - SendGrid, Mailgun, Resend 등 이메일 서비스 연동
   - 주문 확인 이메일 (주문번호, 주문 내역)
   - 배송 시작 알림 이메일 (운송장 번호, 배송 추적 링크)
   - 배송 완료 알림 이메일

2. **SMS 자동 발송**
   - Twilio, Aligo 등 SMS 서비스 연동
   - 주문 확인 SMS
   - 배송 시작 알림 SMS
   - 배송 완료 SMS

3. **결제 고도화**
   - 토스페이먼츠 라이브 키 적용 (운영 전환)
   - 간편결제 수단 추가 활성화
   - 정기결제 지원 (구독 서비스)
   - 환불 자동화 API 연동

4. **재고 관리 고도화**
   - 재고 부족 알림
   - 자동 재고 조정
   - 재고 히스토리 추적
   - 품절 상품 자동 숨김

5. **고객 주문 조회**
   - 고객이 주문번호로 주문 상태 조회
   - 배송 추적 링크 제공
   - 주문 취소 요청 기능
   - 반품/환불 신청 기능

---

**마지막 업데이트**: 2025-11-17  
**버전**: 1.12.1 - Gender Selection Simplification  
**상태**: ✅ 회원가입 성별 옵션 간소화 완료  
**회사명**: 웰씨코리아 (Wellthy Korea)  
**결제 방식**: 토스페이먼츠 라이브 키 (실제 결제 가능)  
**챗봇 서비스**: 사이드톡 AI (Sidetalk AI)  
**배포 상태**: ✅ 프로덕션 배포 완료  
**프로덕션 URL**: https://www.aromapulse.kr  
**최신 배포**: https://dfae79f4.aromapulse.pages.dev

## 🆕 최신 업데이트 (v1.12.1) - 회원가입 성별 선택 간소화 (2025-11-17)

### ✅ 완료된 작업

**1. 성별 선택 옵션 간소화** ✅
- **변경 사항**: 회원가입 폼의 성별 선택에서 "기타(Other)" 옵션 제거
- **현재 옵션**: 남성(Male), 여성(Female) 두 가지만 제공
- **적용 파일**:
  - `/static/signup.html` - 메인 회원가입 페이지
  - `/static/signup-new.html` - 리뉴얼 회원가입 페이지
  - `/static/signup-from-chatbot.html` - 챗봇 연동 회원가입 페이지
  - `/static/profile.html` - 프로필 수정 페이지
- **UI 변경**:
  - signup.html: 라디오 버튼에서 "기타" 제거
  - signup-new.html: 셀렉트 박스에서 "기타" 옵션 제거
  - signup-from-chatbot.html: 셀렉트 박스에서 "기타" 옵션 제거
  - profile.html: 프로필 수정 셀렉트 박스에서 "기타" 옵션 제거

**2. 배포 완료** ✅
- Cloudflare Pages 배포: https://dfae79f4.aromapulse.pages.dev
- 프로덕션 URL: https://www.aromapulse.kr
- Git 커밋: "fix: Remove 기타(Other) gender option from signup forms"

### 🎯 변경 이유

**비즈니스 목적**:
- 데이터 수집 및 분석의 단순화
- 고객 세그멘테이션의 명확화
- 통계 분석의 정확성 향상

**사용자 경험**:
- 선택 옵션 단순화로 회원가입 속도 향상
- 명확한 선택지로 고민 시간 감소

### 📊 영향받는 페이지

1. **회원가입 페이지**:
   - `/signup` - 3단계 회원가입 폼
   - `/signup-new` - 리뉴얼 회원가입 폼
   - `/signup-from-chatbot` - 챗봇 통합 회원가입 폼

2. **프로필 페이지**:
   - `/profile` - 기존 회원의 프로필 수정 시 "기타" 옵션 제거

### 🔄 이전 버전 호환성

**기존 "기타" 데이터**:
- 데이터베이스에 이미 저장된 `gender='other'` 값은 유지됩니다
- 프로필 페이지에서 "기타"로 저장된 사용자는 계속 표시됩니다
- 새로운 가입 및 수정 시에만 "남성" 또는 "여성" 선택 가능

---

## 🆕 이전 업데이트 (v1.11.0) - 사이드톡 AI 챗봇 연동 (2025-11-17)

### ✅ 완료된 작업

**1. 사이드톡 AI 챗봇 서비스 연동** ✅
- **서비스**: 사이드톡 AI (https://sidetalk.kr)
- **사이트 키**: `2836b61bcbfd435c0e1a407bf6ce71885c532aba4c648de494338d3942f565c1`
- **버튼 텍스트**: "AI 상담"
- **위치**: 화면 우측 하단 (20px)
- **적용 페이지**:
  - 메인 페이지 (/)
  - 쇼핑몰 (/shop)
  - 제품 상세 (/static/product-detail)
  - 장바구니 및 결제 (/checkout)
  - 주문 완료 (/order-complete)
  - 로그인 (/login)
  - 회원가입 (/signup, /signup-new)
  - 대시보드 (/dashboard)
  - 프로필 (/profile)

**2. 자체 챗봇 시스템 대체** ✅
- 기존 자체 개발 챗봇 시스템을 타사 서비스로 교체
- 사이드톡 AI의 고급 NLP 및 대화 기능 활용
- 유지보수 부담 감소
- 전문 AI 챗봇 서비스의 안정성 확보

**3. 타사 서비스 선택 이유** 
- ✅ **한국어 특화**: 한국 고객 대응에 최적화
- ✅ **간편한 연동**: 스크립트 추가만으로 즉시 사용 가능
- ✅ **AI 자동응답**: GPT 기반 자연스러운 대화
- ✅ **실시간 상담**: 고객 문의 즉시 응대
- ✅ **데이터 분석**: 고객 대화 내역 분석 및 리포트
- ✅ **CRM 연동 가능**: SIGN KEY를 통한 회원 정보 연동 (향후)
- ✅ **API 제공**: 주문 조회 등 커스텀 기능 연동 가능 (향후)

### 📋 사이드톡 AI 기능

**기본 기능**:
- AI 자동응답 (GPT 기반)
- 실시간 상담원 연결
- 고객 문의 히스토리 관리
- 다양한 템플릿 및 시나리오
- 모바일 최적화 UI

**향후 활용 계획**:
1. **CRM 연동**:
   - SIGN KEY를 사용한 회원 정보 연동
   - 로그인 고객 자동 식별
   - 주문 내역 조회 연동

2. **API 연동**:
   - API KEY를 사용한 커스텀 기능 개발
   - 주문 상태 조회
   - 배송 추적
   - 제품 추천

3. **시나리오 구성**:
   - B2C/B2B 고객 분류
   - 증상별 제품 추천
   - 자주 묻는 질문 자동 응답
   - 구매 프로세스 안내

### 💡 비즈니스 가치

**고객 경험 개선**:
- ✅ 24시간 실시간 고객 응대
- ✅ 전문 AI 챗봇의 자연스러운 대화
- ✅ 빠른 문제 해결

**운영 효율성**:
- ✅ 자체 챗봇 개발/유지보수 비용 절감
- ✅ 전문 서비스의 안정성 확보
- ✅ 지속적인 기능 업데이트 자동 적용

**데이터 활용**:
- ✅ 고객 문의 패턴 분석
- ✅ 자주 묻는 질문 파악
- ✅ 제품 개선 인사이트 도출

---

## 🆕 이전 업데이트 (v1.10.0) - 챗봇 우선 회원가입 통합 (2025-11-17)

### ✅ 완료된 작업

**1. 챗봇-회원가입 통합 플로우** ✅
- **새로운 회원가입 페이지**: `/static/signup-from-chatbot`
- **챗봇 세션 데이터 활용**:
  - URL 파라미터로 `session_id` 전달
  - 챗봇 대화 내역 자동 분석
  - 사용자 정보 자동 추출 및 폼 자동 완성
- **3단계 프로세스 시각화**:
  1. 챗봇 상담 완료 ✅
  2. 회원가입 진행중 ⏳
  3. 서비스 시작 대기 ⏳
- **상담 내용 요약 카드**:
  - 감지된 사용자 유형 (B2C/B2B)
  - 주요 증상 및 니즈
  - 선호 제품 정보
  - 지역 정보

**2. NLP 기반 자동 정보 추출** ✅
- **사용자 유형 감지**:
  - B2B 키워드: 회사, 기업, 법인, 대량, 납품, 마사지, 스파
  - B2C 키워드: 개인, 혼자, 나, 저
- **증상 감지**:
  - 불면: 불면, 잠, 수면
  - 우울: 우울, 기분
  - 불안: 불안, 초조
  - 스트레스: 스트레스, 피로
- **지역 추출**:
  - 17개 광역시도 자동 감지
  - 예: "서울에 살아요" → 지역 자동 선택
- **연락처 추출**:
  - 이름: "제 이름은 홍길동" → 이름 자동 입력
  - 전화번호: 010-1234-5678 패턴 자동 감지

**3. 챗봇 버튼 수정** ✅
- 기존 회원가입 버튼 동작 변경:
  - **이전**: 타입별 회원가입 페이지로 이동
  - **현재**: 세션 ID를 포함한 새 회원가입 페이지로 이동
- 회원가입 버튼 클릭 시:
  - `window.location.href = /static/signup-from-chatbot?session_id=${sessionId}`
  - 챗봇 세션 데이터 자동 전달
  - 세션 없는 경우 에러 처리

### 📋 사용 방법

**고객 여정 (Chatbot-First)**:
1. **챗봇 상담 시작**:
   - 블로그 또는 웹사이트에서 챗봇 아이콘 클릭
   - AI와 대화하며 니즈 파악
   
2. **자동 정보 수집**:
   - AI가 대화 중 자동으로 감지:
     - 사용자 유형 (B2C/B2B)
     - 증상 및 제품 선호도
     - 지역 정보
     - 연락처 (선택적)

3. **회원가입 버튼 클릭**:
   - 챗봇에서 "서비스 이용하기" 버튼 클릭
   - 자동으로 세션 ID 포함된 회원가입 페이지 이동

4. **자동 완성된 폼 확인**:
   - 상담 내용 요약 카드 표시
   - 감지된 정보가 이미 폼에 입력됨
   - 추가 정보만 입력하면 완료

5. **회원가입 완료**:
   - 나머지 필수 정보 입력
   - 가입 완료 → 로그인

### 🎯 기술적 특징

**프론트엔드 (signup-from-chatbot.js)**:
```javascript
// URL에서 세션 ID 추출
const sessionId = new URLSearchParams(window.location.search).get('session_id');

// 챗봇 세션 데이터 로드
async function loadChatbotSession(sessionId) {
  const response = await fetch(`/api/chatbot/session/${sessionId}/messages`);
  const data = await response.json();
  await analyzeChatbotData(data);
}

// NLP 분석으로 정보 추출
async function analyzeChatbotData(data) {
  // 사용자 유형 감지
  if (content.match(/회사|기업|법인|대량|납품/)) {
    detectedInfo.userType = 'B2B';
  }
  
  // 증상 감지
  if (content.match(/불면|잠/)) detectedInfo.symptoms.push('insomnia');
  
  // 지역 추출
  const regionMatch = content.match(/(서울|경기|부산|...)/);
  if (regionMatch) detectedInfo.region = regionMatch[1];
  
  // 이름 추출
  const nameMatch = content.match(/제 이름은 ([가-힣]{2,4})/);
  if (nameMatch) detectedInfo.name = nameMatch[1];
}

// 폼 자동 완성
function updateFormWithDetectedInfo(info) {
  document.getElementById('user_type').value = info.userType;
  if (info.name) document.getElementById('name').value = info.name;
  if (info.region) document.getElementById('region').value = info.region;
  
  // 감지된 니즈를 JSON으로 저장
  const detectedNeeds = {
    symptoms: info.symptoms,
    products: info.products,
    userType: info.userType
  };
  document.getElementById('detected_needs').value = JSON.stringify(detectedNeeds);
}
```

**백엔드 (chatbot.ts - 기존 API 활용)**:
- `GET /api/chatbot/session/:session_id/messages` - 세션 메시지 조회
- 챗봇 대화 내역을 JSON으로 반환
- 기존 감지 로직 재사용 (B2B/B2C 분류, 엔티티 추출)

### 💡 비즈니스 가치

**사용자 경험 개선**:
- ✅ 중복 질문 제거 (챗봇에서 이미 물어본 내용 다시 안 물음)
- ✅ 자동 완성으로 가입 시간 단축
- ✅ 자연스러운 대화 → 회원가입 전환
- ✅ 고객의 니즈를 정확하게 파악한 상태에서 가입

**전환율 향상**:
- ✅ 챗봇 상담 후 회원가입 유도 (warm lead)
- ✅ 가입 폼 작성 부담 감소
- ✅ 맥락을 이해한 온보딩 경험

**데이터 품질 향상**:
- ✅ AI 분석을 통한 정확한 고객 분류
- ✅ 고객 니즈 사전 파악
- ✅ 구조화된 데이터 수집 (`detected_needs` JSON)

### 🔮 향후 개선 계획

1. **감지 정확도 향상**:
   - 더 정교한 NLP 패턴 추가
   - 머신러닝 모델 적용 (향후)
   - 다국어 지원

2. **추가 정보 추출**:
   - 예산 범위 감지
   - 구매 시기 파악
   - 특정 제품 선호도

3. **A/B 테스트**:
   - 챗봇 우선 vs 일반 회원가입 전환율 비교
   - 사용자 만족도 측정
   - 이탈률 분석

4. **관리자 대시보드**:
   - 챗봇 → 회원가입 전환율 추적
   - 자동 완성 정확도 모니터링
   - 감지 실패 케이스 분석

---

## 🆕 이전 업데이트 (v1.9.0) - 회원가입 & 프로필 페이지 리뉴얼 (2025-11-17)

### ✅ 완료된 작업

**1. 회원가입 페이지 리뉴얼** ✅
- **URL**: `/static/signup-new`
- **새로운 디자인**:
  - 애니메이션 그라데이션 배경 (purple → pink → orange → green)
  - 현대적인 카드 스타일 UI
  - 3단계 프로그레스 인디케이터 (숫자 + 체크마크)
  - 호버 효과가 있는 사용자 유형 선택 카드
  - 이모지를 활용한 직관적인 증상 선택
  - 반응형 그리드 레이아웃
- **기능 개선**:
  - 단계별 유효성 검증 강화
  - 실시간 알림 시스템 (성공/실패)
  - 애니메이션 효과 (fade-in, slide)
  - B2C/B2B 구분에 따른 동적 폼 생성
- **사용자 경험**:
  - 직관적인 아이콘과 색상 구분
  - 명확한 단계별 안내 메시지
  - 부드러운 페이지 전환 애니메이션

**2. 회원 프로필 페이지 구현** ✅
- **URL**: `/static/profile`
- **메인 기능**:
  - 사용자 정보 조회 및 수정
  - 3개 탭 구성 (기본 정보, 상세 정보, 주문 내역)
  - 프로필 편집 모드 토글
  - 실시간 정보 업데이트
- **디자인 특징**:
  - 그라데이션 프로필 헤더
  - 정보 카드 스타일 레이아웃
  - 호버 효과가 있는 카드 UI
  - B2C/B2B 구분 뱃지
- **표시 정보**:
  - **기본 정보**: 이름, 휴대폰, 지역, 연령대, 성별, 관심 증상
  - **B2C 상세**: 스트레스 유형, 업종, 직종, 회사 규모
  - **B2B 상세**: 비즈니스 유형, 사업자명, 사업자등록번호, 주소, 웹사이트
  - **주문 내역**: 주문 내역 표시 (향후 연동)

**3. API 엔드포인트 추가** ✅
- `GET /api/auth/profile` - 프로필 조회 (JWT 토큰 기반)
- `PUT /api/auth/profile` - 프로필 업데이트
- **보안**:
  - Bearer 토큰 인증 필수
  - 비밀번호 필드 제외 반환
  - 사용자 ID 검증

### 📋 사용 방법

**새 회원가입 페이지 접속**:
1. `/static/signup-new` 접속
2. B2C/B2B 선택 및 세부 유형 선택
3. 기본 정보 입력 (이메일, 비밀번호, 이름 등)
4. 추가 정보 입력 (유형별 동적 폼)
5. 가입 완료 → 로그인 페이지로 이동

**프로필 페이지 접속**:
1. 로그인 후 `/static/profile` 접속
2. 기본 정보 탭에서 프로필 확인
3. "프로필 수정" 버튼 클릭
4. 정보 수정 후 "저장하기"
5. 상세 정보 탭에서 추가 정보 확인

### 🎯 디자인 컨셉

**공통 디자인 요소**:
- **색상**: Purple (주색상) + Pink (보조색상) + Gradient
- **카드**: 둥근 모서리 (rounded-2xl) + 그림자 효과
- **애니메이션**: Fade-in, hover effects, smooth transitions
- **아이콘**: FontAwesome 6.4.0
- **폰트**: TailwindCSS 기본 폰트 스택

**회원가입 페이지**:
- 애니메이션 그라데이션 배경 (15초 루프)
- 유리 효과 (backdrop-blur) 카드
- 호버 시 카드 상승 효과
- 그라데이션 텍스트 (gradient-text)

**프로필 페이지**:
- 고정된 그라데이션 배경
- 정보 카드 그리드 레이아웃
- 탭 전환 애니메이션
- 편집 모드 토글 UI

### 💡 기술적 특징

**프론트엔드**:
- Vanilla JavaScript (프레임워크 없음)
- TailwindCSS (유틸리티 클래스)
- LocalStorage (토큰 저장)
- Fetch API (RESTful 통신)

**백엔드**:
- Hono Framework (TypeScript)
- JWT 토큰 인증
- Cloudflare D1 (SQLite)
- Web Crypto API (비밀번호 해싱)

**보안**:
- Bearer 토큰 인증
- 클라이언트 측 유효성 검증
- 서버 측 데이터 검증
- 비밀번호 SHA-256 해싱

### 🔮 향후 개선 계획

1. **소셜 로그인 통합**:
   - 회원가입 페이지에 네이버/카카오/구글 로그인 추가
   - 소셜 프로필 정보 자동 연동

2. **프로필 이미지 업로드**:
   - Cloudflare R2 연동
   - 이미지 크롭 및 리사이즈
   - 프로필 사진 변경 기능

3. **주문 내역 연동**:
   - 프로필 페이지 주문 탭 실제 연동
   - 주문 상태 추적
   - 배송 조회 링크

4. **비밀번호 변경**:
   - 현재 비밀번호 확인
   - 새 비밀번호 설정
   - 이메일 인증

5. **회원 탈퇴**:
   - 탈퇴 사유 수집
   - 데이터 삭제 옵션
   - 재가입 제한 설정

---

## 🆕 이전 업데이트 (v1.8.6) - 용량 선택 시스템 (2025-11-17)

### ✅ 완료된 작업

**1. 동적 용량 선택 시스템** ✅
- 제품 타입(concept)과 케어 타입(care_type)에 따라 자동으로 용량 선택 UI 변경
- **리프레시 제품 (자사 제품)**:
  - 드롭다운에서 30ml, 50ml, 100ml 선택 가능
  - 용량 미선택 시 장바구니 담기 불가 (에러 메시지 표시)
- **증상 케어 제품 - 맞춤제작형 (custom)**:
  - "상담 후 결정 (문의 필요)" 파란색 텍스트 표시
  - 용량 선택 불필요 (바로 장바구니 담기 가능)
- **증상 케어 제품 - 완제품형 (ready-made)**:
  - 기존 volume 값이 있으면 해당 값 표시
  - volume 값이 없으면 10ml, 30ml, 50ml, 100ml, 기타 선택 가능
  - "기타" 선택 시 문의 안내 알림

**2. 장바구니 용량 관리** ✅
- 같은 제품이라도 **다른 용량이면 별도 항목**으로 장바구니에 추가
- 예: "라벤더 수면 롤온 30ml"과 "라벤더 수면 롤온 50ml"은 별도 항목
- 장바구니 페이지에서 용량 정보 시각적으로 표시 (보라색 플라스크 아이콘)

**3. 장바구니 UI 개선** ✅
- 제품 카드에 용량 정보 추가 표시
- 아이콘과 함께 직관적인 용량 표시
- 제품명, 컨셉(리프레시/증상케어), 용량을 계층적으로 표시

### 📋 용량 선택 시스템 사용 방법

**고객 사용 흐름**:

1. **리프레시 제품 구매**:
   - 제품 상세 페이지 접속
   - 용량 선택 드롭다운에서 30ml/50ml/100ml 중 선택
   - 용량 선택 후 "장바구니 담기" 또는 "바로 구매하기"
   - 용량 미선택 시 에러 메시지 표시

2. **증상 케어 맞춤제작형 제품 구매**:
   - 제품 상세 페이지 접속
   - "상담 후 결정 (문의 필요)" 안내 확인
   - 용량 선택 없이 바로 장바구니 담기 가능
   - 주문 시 메모에 원하는 용량 기재

3. **증상 케어 완제품형 제품 구매**:
   - 제품 상세 페이지 접속
   - 기존 용량이 있으면 해당 용량으로 표시
   - 용량이 없으면 드롭다운에서 선택
   - "기타" 선택 시 문의 안내 알림

4. **장바구니에서 용량 확인**:
   - 장바구니 페이지에서 각 항목의 용량 확인
   - 같은 제품, 다른 용량은 별도 항목으로 표시
   - 플라스크 아이콘으로 용량 정보 시각적 강조

### 🎯 기술적 특징

**조건부 UI 렌더링**:
```javascript
// 제품 타입에 따라 다른 UI 표시
if (product.concept === 'refresh') {
  // 30ml, 50ml, 100ml 드롭다운
} else if (product.concept === 'symptom_care') {
  if (product.care_type === 'custom') {
    // "상담 후 결정" 텍스트
  } else {
    // 용량 선택 또는 기존 용량 표시
  }
}
```

**장바구니 중복 체크 로직**:
```javascript
// 같은 제품 + 같은 용량인 경우에만 수량 증가
const existingIndex = cart.findIndex(item => 
  item.id === currentProduct.id && item.volume === selectedVolume
);
```

### 💡 비즈니스 가치

**고객 경험 개선**:
- 제품 타입에 맞는 최적화된 구매 프로세스
- 명확한 용량 정보 제공
- 문의가 필요한 경우 명시적 안내

**재고 관리 정확성**:
- 용량별 별도 관리 가능
- 향후 용량별 가격 차등 적용 가능
- 용량별 재고 추적 기반 마련

**유연한 비즈니스 모델**:
- 자사 제품(리프레시): 표준화된 용량 선택
- 공방 제품(증상케어): 맞춤 제작 또는 기존 제품 선택
- 고객 니즈에 따른 다양한 구매 옵션 제공

---

## 🆕 이전 업데이트 (v1.8.5) - 제품 상세 페이지 (2025-11-17)

### ✅ 완료된 작업

**1. 제품 상세 페이지 구현** ✅
- **URL**: `/static/product-detail?id={product_id}`
- **기능**:
  - 대표 이미지 (thumbnail_image) 상단 표시
  - 일체형 상세 이미지 (detail_image) 하단 표시
  - 제품 기본 정보 (이름, 설명, 가격, 카테고리, 용량, 재고)
  - 수량 선택 UI (증가/감소 버튼)
  - 장바구니 담기 기능
  - 바로 구매 기능
  - 카테고리 한글 표시 (불면증, 우울증, 불안, 스트레스, 리프레시)
  - 재고 상태 색상 표시 (재고 있음: 초록색, 품절: 빨간색)

**2. 메인 페이지 연동** ✅
- 메인 페이지 "인기 제품" 섹션에서 제품 카드 클릭 시 상세 페이지로 이동
- Cloudflare Pages 호환성을 위해 `.html` 확장자 제거

**3. 쇼핑 페이지 연동** ✅
- `/shop` 페이지에서 "상세보기" 버튼 클릭 시 상세 페이지로 이동
- 제품별 고유 ID를 URL 파라미터로 전달

**4. API 엔드포인트 추가** ✅
- `GET /api/products/:id` - 단일 제품 상세 조회
- 제품 ID 유효성 검증
- 활성화된 제품만 조회 (`is_active = 1`)
- Base64 이미지 데이터 포함 반환

### 📋 제품 상세 페이지 사용 방법

**고객 사용 흐름**:
1. **메인 페이지** (https://www.aromapulse.kr) 접속
2. "인기 제품" 섹션에서 제품 카드 클릭
   - 또는 `/shop` 페이지에서 "상세보기" 버튼 클릭
3. 제품 상세 페이지 자동 이동
4. 제품 정보 확인:
   - 대표 이미지 확인
   - 제품 설명, 가격, 재고 확인
   - 상세 이미지 스크롤하여 확인
5. 수량 선택 후:
   - "장바구니 담기" 버튼 클릭 → 쇼핑 계속
   - "바로 구매하기" 버튼 클릭 → 결제 페이지로 이동

**관리자 확인**:
- 관리자가 등록한 대표 이미지 (thumbnail_image)와 상세 이미지 (detail_image)가 자동으로 표시됩니다
- 이미지는 Base64 형식으로 D1 데이터베이스에 저장됩니다

### 🎯 기술적 특징

**Cloudflare Pages 최적화**:
- URL에서 `.html` 확장자 제거 (Cloudflare Pages 자동 리다이렉트 호환)
- `/static/product-detail?id=28` 형식으로 접근
- 정적 파일 서빙 최적화 (`_routes.json`에서 `/static/*` 제외)

**사용자 경험 개선**:
- 카테고리 한글 매핑 (insomnia → 불면증)
- 재고 상태 색상 코드 (초록색/빨간색)
- 반응형 디자인 (모바일/데스크톱 최적화)
- LocalStorage 기반 장바구니 연동

**데이터 흐름**:
```
사용자 클릭 → /static/product-detail?id=28
               ↓
        JavaScript에서 URL 파라미터 추출
               ↓
        GET /api/products/28 호출
               ↓
        Cloudflare D1에서 제품 데이터 조회
               ↓
        UI 업데이트 (이미지, 텍스트, 가격 등)
```

### 💡 비즈니스 가치

**고객 전환율 향상**:
- 제품 정보를 상세하게 확인 가능
- 대표 이미지와 상세 이미지 모두 제공
- 구매 결정에 필요한 모든 정보 제공

**관리 효율성**:
- 관리자가 업로드한 이미지 자동 표시
- 별도 페이지 수정 불필요
- 제품 등록 시 이미지만 업로드하면 자동 연동

**SEO 및 접근성**:
- 의미 있는 URL 구조 (`/static/product-detail?id=28`)
- 각 제품마다 고유 URL 제공
- 공유 및 북마크 가능

---

### 💳 결제 시스템 (v1.8.4) - 실제 결제 활성화

**토스페이먼츠 라이브 키 적용** ⭐ 실제 결제 가능
- **상태**: ✅ 실제 결제 시스템 활성화 완료
- **적용 날짜**: 2025-11-16
- **클라이언트 키**: `live_ck_ZLKGPx4M3Mn5J0ye7mj2VBaWypv1` (프론트엔드)
- **시크릿 키**: Cloudflare Pages Secrets에 안전하게 저장 (백엔드)
- **지원 결제 수단**:
  - 신용/체크카드
  - 계좌이체
  - 가상계좌
  - 간편결제 (토스페이, 카카오페이, 네이버페이 등)

**주문 프로세스** (완전 자동화):
1. 장바구니 → 주문서 작성
2. 토스페이먼츠 결제 위젯에서 결제 수단 선택
3. 결제하기 버튼 클릭 → 실제 결제 진행
4. 결제 승인 후 주문 자동 생성
5. 재고 자동 차감
6. 주문 완료 페이지 표시

**보안**:
- ✅ HTTPS 통신
- ✅ 서버 측 결제 승인 검증
- ✅ Amount 위변조 방지
- ✅ 환경 변수로 시크릿 키 관리

### 🔧 최신 수정 사항 (v1.8.4)
1. ✅ **실제 결제 시스템 활성화**: 토스페이먼츠 라이브 키 적용 (2025-11-16)
2. ✅ **프로덕션 배포**: https://www.aromapulse.kr에서 실제 결제 가능
3. ✅ **Cloudflare Pages Secrets 설정**: TOSS_SECRET_KEY, TOSS_CLIENT_KEY 등록
4. ✅ **프론트엔드 라이브 키 업데이트**: checkout.js에 라이브 클라이언트 키 적용
5. ✅ **백엔드 환경 변수 설정**: .dev.vars에 라이브 키 설정
6. ✅ **결제 SDK 로딩 개선**: waitForTossPayments() 함수로 SDK 로드 대기
7. ✅ **CORS/CSP 설정**: _headers 파일로 토스페이먼츠 SDK 허용
8. ✅ **Git 커밋 완료**: "Enable live payment with Toss Payments"

### 🎯 토스페이먼츠 SDK v2 주요 특징

**결제 위젯 SDK v2의 장점**:
- ✅ **간편한 연동**: 복잡한 설정 없이 간단한 초기화로 결제 UI 렌더링
- ✅ **자동 UI 관리**: 토스페이먼츠가 결제 수단 UI를 자동으로 관리 및 업데이트
- ✅ **다양한 결제 수단**: 카드, 계좌이체, 가상계좌, 간편결제 등 자동 지원
- ✅ **반응형 디자인**: 모바일/데스크톱 환경에 자동 최적화
- ✅ **보안 강화**: PCI-DSS 인증, 3D Secure 자동 처리
- ✅ **실시간 업데이트**: 토스페이먼츠에서 새로운 결제 수단 추가 시 자동 반영

**구현 완료 사항**:
1. ✅ 결제 위젯 SDK v2 연동 (`https://js.tosspayments.com/v2/payment-widget`)
2. ✅ 결제 UI 자동 렌더링 (결제 수단 선택, 이용약관 동의)
3. ✅ 결제 승인 API (`POST /api/orders/confirm-payment`)
4. ✅ 재고 자동 차감 (결제 성공 시)
5. ✅ 주문 상태 자동 업데이트 (`payment_status='paid'`, `order_status='confirmed'`)
6. ✅ 결제 성공/실패 페이지
7. ✅ 장바구니 자동 비우기 (결제 완료 후)
