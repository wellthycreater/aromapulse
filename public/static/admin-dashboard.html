<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>아로마펄스 관리자 대시보드</title>
    <link rel="icon" type="image/png" href="/static/favicon.png">
    
    <script>
        // 페이지 로드 전 즉시 토큰 확인 (무한 리다이렉트 방지)
        console.log('=== Admin Dashboard Pre-Auth Check ===');
        const token = localStorage.getItem('adminToken') || 
                      localStorage.getItem('admin_token') || 
                      localStorage.getItem('auth_token') || 
                      localStorage.getItem('token');
        console.log('Token exists:', !!token);
        console.log('Token value:', token ? token.substring(0, 20) + '...' : 'null');
        
        if (!token) {
            console.log('No token found, redirecting to login...');
            alert('로그인이 필요합니다.');
            window.location.replace('/admin-login');
            // Prevent page from loading
            document.documentElement.innerHTML = '<body style="margin:0;padding:20px;font-family:sans-serif;">Redirecting to login...</body>';
            throw new Error('No auth token');
        } else {
            console.log('Token found, proceeding to load dashboard');
        }
    </script>
    
    <!-- External Libraries -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
    
    <style>
        /* Custom Colors - Sage Green + Lavender Theme */
        :root {
            --sage-green: #7AA992;
            --lavender: #BCA6E0;
            --cream: #F3EDEA;
            --dark-slate: #263238;
            --medium-gray: #55606A;
            --light-gray: #E6ECEB;
        }
        
        /* Utility Classes */
        .bg-sage { background-color: var(--sage-green); }
        .bg-lavender { background-color: var(--lavender); }
        .bg-cream { background-color: var(--cream); }
        .text-sage { color: var(--sage-green); }
        .text-lavender { color: var(--lavender); }
        .border-sage { border-color: var(--sage-green); }
        .hover\:bg-sage:hover { background-color: var(--sage-green); }
        .hover\:bg-lavender:hover { background-color: var(--lavender); }
        
        /* Tab Styling */
        .tab-button {
            transition: all 0.3s ease;
            position: relative;
        }
        .tab-button.active {
            background-color: var(--sage-green);
            color: white;
        }
        .tab-button.active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            height: 3px;
            background-color: var(--sage-green);
        }
        
        /* Sub-tab Styling */
        .sub-tab-button {
            transition: all 0.3s ease;
        }
        .sub-tab-button.active {
            background-color: var(--lavender);
            color: white;
        }
        
        /* Animations */
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: var(--light-gray);
        }
        ::-webkit-scrollbar-thumb {
            background: var(--sage-green);
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #6A9882;
        }
        
        /* Modal Backdrop */
        .modal-backdrop {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
        }
        
        /* Card Hover Effect */
        .hover-lift {
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        .hover-lift:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }
        
        /* Status Badge */
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.875rem;
            font-weight: 600;
        }
        
        .status-active {
            background-color: #DEF7EC;
            color: #03543F;
        }
        
        .status-inactive {
            background-color: #FDE8E8;
            color: #9B1C1C;
        }
    </style>
</head>
<body class="bg-cream min-h-screen">
    
    <!-- Header -->
    <header class="bg-white shadow-md sticky top-0 z-50">
        <nav class="container mx-auto px-6 py-4">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <img src="/static/logo-light.png" alt="아로마펄스" class="h-12">
                    <div>
                        <h1 class="text-2xl font-bold text-sage">
                            <i class="fas fa-spa mr-2"></i>
                            관리자 대시보드
                        </h1>
                        <p class="text-xs text-gray-500 mt-1">AromaPulse Admin Dashboard</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <div class="text-sm text-gray-600">
                        <i class="fas fa-user-shield mr-1"></i>
                        <span id="admin-name">관리자</span>
                    </div>
                    <button onclick="logout()" class="text-red-600 hover:text-red-700 transition font-semibold">
                        <i class="fas fa-sign-out-alt mr-2"></i>로그아웃
                    </button>
                </div>
            </div>
        </nav>
    </header>

    <!-- Main Navigation Tabs -->
    <div class="bg-white border-b shadow-sm">
        <div class="container mx-auto px-6">
            <div class="flex space-x-1 overflow-x-auto">
                <button onclick="switchMainTab('dashboard')" 
                    class="tab-button px-6 py-4 font-semibold whitespace-nowrap hover:bg-gray-100 active" 
                    data-tab="dashboard">
                    <i class="fas fa-chart-line mr-2"></i>대시보드
                </button>
                <button onclick="switchMainTab('users')" 
                    class="tab-button px-6 py-4 font-semibold whitespace-nowrap hover:bg-gray-100" 
                    data-tab="users">
                    <i class="fas fa-users mr-2"></i>회원 관리
                </button>
                <button onclick="switchMainTab('products')" 
                    class="tab-button px-6 py-4 font-semibold whitespace-nowrap hover:bg-gray-100" 
                    data-tab="products">
                    <i class="fas fa-box mr-2"></i>제품 관리
                </button>
                <button onclick="switchMainTab('blog')" 
                    class="tab-button px-6 py-4 font-semibold whitespace-nowrap hover:bg-gray-100" 
                    data-tab="blog">
                    <i class="fas fa-blog mr-2"></i>블로그 관리
                </button>
                <button onclick="switchMainTab('workshops')" 
                    class="tab-button px-6 py-4 font-semibold whitespace-nowrap hover:bg-gray-100" 
                    data-tab="workshops">
                    <i class="fas fa-hands-helping mr-2"></i>워크샵 관리
                </button>
                <button onclick="switchMainTab('classes')" 
                    class="tab-button px-6 py-4 font-semibold whitespace-nowrap hover:bg-gray-100" 
                    data-tab="classes">
                    <i class="fas fa-chalkboard-teacher mr-2"></i>원데이 클래스
                </button>
            </div>
        </div>
    </div>

    <!-- Main Content Area -->
    <div class="container mx-auto px-6 py-8">
        
        <!-- Dashboard Section -->
        <div id="section-dashboard" class="content-section">
            <div class="fade-in">
                <h2 class="text-3xl font-bold text-dark-slate mb-6">
                    <i class="fas fa-chart-line text-sage mr-3"></i>대시보드
                </h2>
                
                <!-- Stats Grid -->
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-sage hover-lift">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">전체 회원</p>
                                <p class="text-3xl font-bold text-sage" id="stat-users">-</p>
                            </div>
                            <i class="fas fa-users text-4xl text-sage opacity-20"></i>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-lavender hover-lift">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">전체 제품</p>
                                <p class="text-3xl font-bold text-lavender" id="stat-products">-</p>
                            </div>
                            <i class="fas fa-box text-4xl text-lavender opacity-20"></i>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-blue-500 hover-lift">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">워크샵</p>
                                <p class="text-3xl font-bold text-blue-600" id="stat-workshops">-</p>
                            </div>
                            <i class="fas fa-hands-helping text-4xl text-blue-500 opacity-20"></i>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-md p-6 border-l-4 border-green-500 hover-lift">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-sm text-gray-600 mb-1">원데이 클래스</p>
                                <p class="text-3xl font-bold text-green-600" id="stat-classes">-</p>
                            </div>
                            <i class="fas fa-chalkboard-teacher text-4xl text-green-500 opacity-20"></i>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity -->
                <div class="bg-white rounded-xl shadow-md p-6">
                    <h3 class="text-xl font-bold text-gray-800 mb-4">
                        <i class="fas fa-clock text-sage mr-2"></i>최근 활동
                    </h3>
                    <div id="recent-activity" class="space-y-3">
                        <p class="text-gray-500 text-center py-8">로딩 중...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Users Section -->
        <div id="section-users" class="content-section hidden">
            <div class="fade-in">
                <h2 class="text-3xl font-bold text-dark-slate mb-6">
                    <i class="fas fa-users text-sage mr-3"></i>회원 관리
                </h2>

                <!-- Search and Filter -->
                <div class="bg-white rounded-xl shadow-md p-4 mb-6">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                        <input type="text" id="user-search" placeholder="이름, 이메일 검색..." 
                            class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sage focus:border-transparent">
                        <select id="user-type-filter" 
                            class="px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-sage focus:border-transparent">
                            <option value="">전체 회원 유형</option>
                            <option value="B2C">개인 (B2C)</option>
                            <option value="B2B">기업 (B2B)</option>
                        </select>
                        <button onclick="searchUsers()" 
                            class="bg-sage text-white px-6 py-2 rounded-lg hover:opacity-90 transition font-semibold">
                            <i class="fas fa-search mr-2"></i>검색
                        </button>
                    </div>
                </div>

                <!-- Users Table -->
                <div class="bg-white rounded-xl shadow-md overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 border-b">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">이름</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">이메일</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">회원유형</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">역할</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">가입일</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">상태</th>
                                </tr>
                            </thead>
                            <tbody id="users-table-body">
                                <tr>
                                    <td colspan="6" class="px-6 py-8 text-center text-gray-500">
                                        <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                                        <p>데이터를 불러오는 중...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="px-6 py-4 border-t bg-gray-50">
                        <p class="text-sm text-gray-600">총 <span id="users-total">0</span>명</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Products Section -->
        <div id="section-products" class="content-section hidden">
            <div class="fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-dark-slate">
                        <i class="fas fa-box text-sage mr-3"></i>제품 관리
                    </h2>
                    <button onclick="openProductModal()" 
                        class="bg-sage text-white px-6 py-3 rounded-lg hover:opacity-90 transition font-semibold">
                        <i class="fas fa-plus mr-2"></i>제품 등록
                    </button>
                </div>

                <!-- Products Grid -->
                <div id="products-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="col-span-full text-center py-12 text-gray-500">
                        <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                        <p>데이터를 불러오는 중...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Blog Section -->
        <div id="section-blog" class="content-section hidden">
            <div class="fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-dark-slate">
                        <i class="fas fa-blog text-sage mr-3"></i>블로그 관리
                    </h2>
                    <button onclick="openBlogModal()" 
                        class="bg-sage text-white px-6 py-3 rounded-lg hover:opacity-90 transition font-semibold">
                        <i class="fas fa-plus mr-2"></i>포스트 작성
                    </button>
                </div>

                <!-- Blog Table -->
                <div class="bg-white rounded-xl shadow-md overflow-hidden">
                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead class="bg-gray-50 border-b">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">제목</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">카테고리</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">조회수</th>
                                    <th class="px-6 py-3 text-left text-xs font-semibold text-gray-600 uppercase">작성일</th>
                                    <th class="px-6 py-3 text-center text-xs font-semibold text-gray-600 uppercase">관리</th>
                                </tr>
                            </thead>
                            <tbody id="blog-table-body">
                                <tr>
                                    <td colspan="5" class="px-6 py-8 text-center text-gray-500">
                                        <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                                        <p>데이터를 불러오는 중...</p>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="px-6 py-4 border-t bg-gray-50">
                        <p class="text-sm text-gray-600">총 <span id="blog-total">0</span>개</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Workshops Section -->
        <div id="section-workshops" class="content-section hidden">
            <div class="fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-dark-slate">
                        <i class="fas fa-hands-helping text-sage mr-3"></i>워크샵 관리
                    </h2>
                    <button onclick="openWorkshopModal()" 
                        class="bg-sage text-white px-6 py-3 rounded-lg hover:opacity-90 transition font-semibold">
                        <i class="fas fa-plus mr-2"></i>워크샵 등록
                    </button>
                </div>

                <!-- Workshops Grid -->
                <div id="workshops-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="col-span-full text-center py-12 text-gray-500">
                        <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                        <p>데이터를 불러오는 중...</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Classes Section -->
        <div id="section-classes" class="content-section hidden">
            <div class="fade-in">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-3xl font-bold text-dark-slate">
                        <i class="fas fa-chalkboard-teacher text-sage mr-3"></i>원데이 클래스 관리
                    </h2>
                    <button onclick="openClassModal()" 
                        class="bg-sage text-white px-6 py-3 rounded-lg hover:opacity-90 transition font-semibold">
                        <i class="fas fa-plus mr-2"></i>클래스 등록
                    </button>
                </div>

                <!-- Classes Grid -->
                <div id="classes-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <div class="col-span-full text-center py-12 text-gray-500">
                        <i class="fas fa-spinner fa-spin text-2xl mb-2"></i>
                        <p>데이터를 불러오는 중...</p>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!-- Product Modal -->
    <div id="product-modal" class="hidden fixed inset-0 modal-backdrop z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <div class="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center">
                    <h3 class="text-2xl font-bold text-gray-800">
                        <i class="fas fa-box mr-2"></i><span id="product-modal-title">제품 등록</span>
                    </h3>
                    <button onclick="closeProductModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                <form id="product-form" class="p-6" onsubmit="saveProduct(event)">
                    <input type="hidden" id="product-id">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">제품명</label>
                            <input type="text" id="product-name" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage">
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">가격 (원)</label>
                                <input type="number" id="product-price" required min="0" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">재고</label>
                                <input type="number" id="product-stock" required min="0" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage">
                            </div>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">설명</label>
                            <textarea id="product-description" rows="3" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage"></textarea>
                        </div>
                        <div>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="product-is-active" checked class="w-5 h-5 text-sage rounded">
                                <span class="text-sm font-semibold text-gray-700">판매중</span>
                            </label>
                        </div>
                    </div>
                    <div class="mt-6 flex space-x-3">
                        <button type="submit" class="flex-1 bg-sage text-white px-6 py-3 rounded-lg hover:opacity-90 font-semibold">
                            <i class="fas fa-save mr-2"></i>저장
                        </button>
                        <button type="button" onclick="closeProductModal()" class="flex-1 bg-gray-300 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-400 font-semibold">
                            <i class="fas fa-times mr-2"></i>취소
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Workshop Modal -->
    <div id="workshop-modal" class="hidden fixed inset-0 modal-backdrop z-50 overflow-y-auto">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                <div class="sticky top-0 bg-white border-b px-6 py-4 flex justify-between items-center">
                    <h3 class="text-2xl font-bold text-gray-800">
                        <i class="fas fa-hands-helping mr-2"></i><span id="workshop-modal-title">워크샵 등록</span>
                    </h3>
                    <button onclick="closeWorkshopModal()" class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>
                <form id="workshop-form" class="p-6" onsubmit="saveWorkshop(event)">
                    <input type="hidden" id="workshop-id">
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">워크샵명</label>
                            <input type="text" id="workshop-title" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">설명</label>
                            <textarea id="workshop-description" rows="3" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage"></textarea>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">가격 (원)</label>
                                <input type="number" id="workshop-price" required min="0" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">소요시간 (분)</label>
                                <input type="number" id="workshop-duration" required min="0" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage">
                            </div>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">최대 참여자</label>
                                <input type="number" id="workshop-max-participants" required min="1" class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage">
                            </div>
                            <div>
                                <label class="block text-sm font-semibold text-gray-700 mb-2">지역</label>
                                <input type="text" id="workshop-location" required class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-sage">
                            </div>
                        </div>
                        <div>
                            <label class="flex items-center space-x-2">
                                <input type="checkbox" id="workshop-is-active" checked class="w-5 h-5 text-sage rounded">
                                <span class="text-sm font-semibold text-gray-700">활성</span>
                            </label>
                        </div>
                    </div>
                    <div class="mt-6 flex space-x-3">
                        <button type="submit" class="flex-1 bg-sage text-white px-6 py-3 rounded-lg hover:opacity-90 font-semibold">
                            <i class="fas fa-save mr-2"></i>저장
                        </button>
                        <button type="button" onclick="closeWorkshopModal()" class="flex-1 bg-gray-300 text-gray-700 px-6 py-3 rounded-lg hover:bg-gray-400 font-semibold">
                            <i class="fas fa-times mr-2"></i>취소
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Main JavaScript -->
    <script src="/static/admin-dashboard.js"></script>
</body>
</html>
