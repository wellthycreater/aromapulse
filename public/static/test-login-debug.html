<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë¡œê·¸ì¸ ë””ë²„ê·¸ í…ŒìŠ¤íŠ¸</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #f0f0f0; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 20px; border-radius: 8px; }
        button { padding: 10px 20px; margin: 5px; font-size: 16px; cursor: pointer; }
        .log { margin: 5px 0; padding: 5px; border-left: 3px solid #ccc; }
        .success { border-color: green; background: #f0fff0; }
        .error { border-color: red; background: #fff0f0; }
        .info { border-color: blue; background: #f0f0ff; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ” ë¡œê·¸ì¸ ë””ë²„ê·¸ í…ŒìŠ¤íŠ¸</h1>
        
        <div>
            <button onclick="testLogin()">1. ë¡œê·¸ì¸ í…ŒìŠ¤íŠ¸</button>
            <button onclick="checkStorage()">2. localStorage í™•ì¸</button>
            <button onclick="goToDashboard()">3. ëŒ€ì‹œë³´ë“œë¡œ ì´ë™</button>
            <button onclick="clearStorage()">ì´ˆê¸°í™”</button>
        </div>
        
        <h2>ë¡œê·¸:</h2>
        <div id="logs"></div>
    </div>

    <script>
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `<strong>[${new Date().toLocaleTimeString()}]</strong> ${message}`;
            document.getElementById('logs').appendChild(div);
            console.log(message);
        }

        async function testLogin() {
            try {
                log('=== ë¡œê·¸ì¸ ì‹œì‘ ===', 'info');
                
                const response = await fetch('/api/auth/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        email: 'b2c@test.com',
                        password: 'test'
                    })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    log('âœ“ ë¡œê·¸ì¸ ì„±ê³µ!', 'success');
                    log(`  ì‚¬ìš©ì: ${data.user.name} (${data.user.email})`, 'success');
                    log(`  íƒ€ì…: ${data.user.user_type}`, 'success');
                    log(`  í† í° ê¸¸ì´: ${data.token.length}`, 'info');
                    
                    // localStorageì— ì €ì¥
                    localStorage.setItem('token', data.token);
                    localStorage.setItem('user', JSON.stringify(data.user));
                    log('âœ“ localStorageì— ì €ì¥ ì™„ë£Œ', 'success');
                    
                    checkStorage();
                } else {
                    log(`âœ— ë¡œê·¸ì¸ ì‹¤íŒ¨: ${data.error}`, 'error');
                }
            } catch (error) {
                log(`âœ— ì—ëŸ¬: ${error.message}`, 'error');
            }
        }

        function checkStorage() {
            log('=== localStorage í™•ì¸ ===', 'info');
            
            const token = localStorage.getItem('token');
            const userStr = localStorage.getItem('user');
            
            if (!token) {
                log('âœ— tokenì´ ì—†ìŠµë‹ˆë‹¤!', 'error');
            } else {
                log(`âœ“ token ìˆìŒ (${token.substring(0, 50)}...)`, 'success');
            }
            
            if (!userStr) {
                log('âœ— userê°€ ì—†ìŠµë‹ˆë‹¤!', 'error');
            } else {
                log(`âœ“ user ìˆìŒ`, 'success');
                try {
                    const user = JSON.parse(userStr);
                    log(`  - email: ${user.email}`, 'info');
                    log(`  - name: ${user.name}`, 'info');
                    log(`  - user_type: ${user.user_type}`, 'info');
                    log(`  - id: ${user.id}`, 'info');
                } catch (e) {
                    log(`âœ— user JSON íŒŒì‹± ì‹¤íŒ¨: ${e.message}`, 'error');
                }
            }
        }

        function goToDashboard() {
            log('=== ëŒ€ì‹œë³´ë“œë¡œ ì´ë™ ===', 'info');
            const token = localStorage.getItem('token');
            const userStr = localStorage.getItem('user');
            
            if (!token || !userStr) {
                log('âœ— token ë˜ëŠ” userê°€ ì—†ì–´ì„œ ì´ë™ ë¶ˆê°€', 'error');
                return;
            }
            
            log('âœ“ 3ì´ˆ í›„ ëŒ€ì‹œë³´ë“œë¡œ ì´ë™í•©ë‹ˆë‹¤...', 'success');
            setTimeout(() => {
                window.location.href = '/dashboard';
            }, 3000);
        }

        function clearStorage() {
            localStorage.clear();
            log('=== localStorage ì´ˆê¸°í™” ì™„ë£Œ ===', 'info');
        }
    </script>
</body>
</html>
