<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>주문 완료 - 아로마펄스</title>
    <link rel="icon" type="image/png" href="/static/favicon.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-12">
        <div class="max-w-2xl mx-auto">
            <!-- 성공 메시지 -->
            <div class="text-center mb-8">
                <div class="inline-block p-6 bg-blue-100 rounded-full mb-4">
                    <i class="fas fa-clock text-6xl text-blue-600"></i>
                </div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">주문이 접수되었습니다!</h1>
                <p class="text-gray-600 mb-4">고객님의 주문이 성공적으로 접수되었습니다.</p>
                <div class="bg-yellow-50 border border-yellow-200 rounded-lg p-4 inline-block">
                    <p class="text-yellow-800 font-semibold">
                        <i class="fas fa-envelope mr-2"></i>결제 링크가 이메일/문자로 발송됩니다
                    </p>
                    <p class="text-sm text-yellow-700 mt-1">받으신 링크를 통해 결제를 완료해주세요</p>
                </div>
            </div>

            <!-- 주문 정보 -->
            <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-receipt mr-2"></i>주문 정보
                </h2>
                <div class="space-y-3">
                    <div class="flex justify-between">
                        <span class="text-gray-600">주문 번호</span>
                        <span class="font-bold" id="order-number">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">주문 날짜</span>
                        <span id="order-date">-</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">주문 상태</span>
                        <span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm font-semibold" id="order-status">결제 대기</span>
                    </div>
                    <div class="flex justify-between">
                        <span class="text-gray-600">결제 상태</span>
                        <span class="px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm font-semibold" id="payment-status">결제 대기</span>
                    </div>
                    <div class="flex justify-between text-lg font-bold text-purple-600 pt-3 border-t">
                        <span>결제 금액</span>
                        <span id="final-amount">-</span>
                    </div>
                </div>
            </div>

            <!-- 주문 상품 -->
            <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-box mr-2"></i>주문 상품
                </h2>
                <div id="order-items" class="space-y-3">
                    <!-- 동적으로 추가됩니다 -->
                </div>
            </div>

            <!-- 배송 정보 -->
            <div class="bg-white rounded-xl shadow-md p-6 mb-6">
                <h2 class="text-xl font-bold text-gray-800 mb-4">
                    <i class="fas fa-truck mr-2"></i>배송 정보
                </h2>
                <div class="space-y-2 text-sm">
                    <p><strong>받는 분:</strong> <span id="customer-name">-</span></p>
                    <p><strong>연락처:</strong> <span id="customer-phone">-</span></p>
                    <p><strong>주소:</strong> <span id="customer-address">-</span></p>
                </div>
            </div>

            <!-- 결제 안내 -->
            <div class="bg-orange-50 border border-orange-200 rounded-xl p-6 mb-4">
                <h3 class="font-bold text-orange-800 mb-3">
                    <i class="fas fa-credit-card mr-2"></i>결제 안내
                </h3>
                <ul class="text-sm text-orange-700 space-y-2">
                    <li class="flex items-start">
                        <i class="fas fa-check mr-2 mt-1"></i>
                        <span><strong>결제 링크 발송:</strong> 주문 확인 후 이메일/문자로 결제 링크가 발송됩니다 (보통 1시간 이내)</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check mr-2 mt-1"></i>
                        <span><strong>결제 방법:</strong> 받으신 링크를 클릭하여 카드결제, 계좌이체, 가상계좌 등으로 결제하실 수 있습니다</span>
                    </li>
                    <li class="flex items-start">
                        <i class="fas fa-check mr-2 mt-1"></i>
                        <span><strong>결제 기한:</strong> 링크 수신 후 24시간 이내에 결제를 완료해주세요</span>
                    </li>
                </ul>
            </div>

            <!-- 안내 사항 -->
            <div class="bg-blue-50 border border-blue-200 rounded-xl p-6 mb-6">
                <h3 class="font-bold text-blue-800 mb-2">
                    <i class="fas fa-info-circle mr-2"></i>배송 안내
                </h3>
                <ul class="text-sm text-blue-700 space-y-1">
                    <li>• 결제 확인 후 1~2일 이내에 배송이 시작됩니다.</li>
                    <li>• 배송 시작 시 문자 또는 이메일로 송장 번호가 발송됩니다.</li>
                    <li>• 주문 관련 문의는 고객센터로 연락 주시기 바랍니다.</li>
                </ul>
            </div>

            <!-- 버튼 -->
            <div class="flex gap-4">
                <a href="/shop.html" class="flex-1 text-center bg-gray-200 text-gray-800 px-6 py-4 rounded-lg font-bold hover:bg-gray-300">
                    <i class="fas fa-shopping-bag mr-2"></i>계속 쇼핑하기
                </a>
                <a href="/" class="flex-1 text-center bg-purple-600 text-white px-6 py-4 rounded-lg font-bold hover:bg-purple-700">
                    <i class="fas fa-home mr-2"></i>홈으로
                </a>
            </div>
        </div>
    </div>

    <script>
        // URL에서 주문 번호 추출
        const urlParams = new URLSearchParams(window.location.search);
        const orderNumber = urlParams.get('order_number');

        if (!orderNumber) {
            alert('주문 정보를 찾을 수 없습니다');
            window.location.href = '/shop.html';
        } else {
            loadOrderInfo(orderNumber);
        }

        // 주문 정보 로드
        async function loadOrderInfo(orderNumber) {
            try {
                const response = await fetch(`/api/orders/${orderNumber}`);
                
                if (!response.ok) {
                    throw new Error('주문 정보 조회 실패');
                }
                
                const data = await response.json();
                const order = data.order;
                const items = data.items;
                
                // 주문 정보 표시
                document.getElementById('order-number').textContent = order.order_number;
                document.getElementById('order-date').textContent = new Date(order.created_at).toLocaleString('ko-KR');
                document.getElementById('final-amount').textContent = `${order.final_amount.toLocaleString()}원`;
                
                // 주문자 정보
                document.getElementById('customer-name').textContent = order.customer_name;
                document.getElementById('customer-phone').textContent = order.customer_phone;
                document.getElementById('customer-address').textContent = 
                    `[${order.customer_zipcode || ''}] ${order.customer_address || ''} ${order.customer_detail_address || ''}`;
                
                // 주문 상품 렌더링
                const orderItemsEl = document.getElementById('order-items');
                orderItemsEl.innerHTML = '';
                
                items.forEach(item => {
                    const itemEl = document.createElement('div');
                    itemEl.className = 'flex justify-between items-center border-b pb-3';
                    itemEl.innerHTML = `
                        <div>
                            <p class="font-semibold">${item.product_name}</p>
                            <p class="text-sm text-gray-600">수량: ${item.quantity}개</p>
                        </div>
                        <p class="font-bold text-purple-600">${item.total_price.toLocaleString()}원</p>
                    `;
                    orderItemsEl.appendChild(itemEl);
                });
                
                // 장바구니 비우기
                localStorage.removeItem('cart');
                
            } catch (error) {
                console.error('주문 정보 로드 오류:', error);
                alert('주문 정보를 불러오는 중 오류가 발생했습니다');
            }
        }
    </script>
</body>
</html>
