# ìœ„ì¹˜ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ íŠ¸ëŸ¬ë¸”ìŠˆíŒ… ê°€ì´ë“œ

## âŒ ì¦ìƒ

**"ìœ„ì¹˜ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤ (HTTP 500)" ì—ëŸ¬ ë°œìƒ**

```
aromapulse.pages.devì˜ ë©”ì‹œì§€
âŒ ìœ„ì¹˜ ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.

ìœ„ì¹˜ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ (HTTP 500)

ğŸ’¡ ë¡œê·¸ì¸ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.
```

---

## ğŸ” ì›ì¸ ë¶„ì„

### ê°€ëŠ¥í•œ ì›ì¸ë“¤

**1. ë¡œê·¸ì¸ ì„¸ì…˜ ë§Œë£Œ**
- JWT í† í°ì´ ë§Œë£Œë˜ì—ˆê±°ë‚˜ ì¿ í‚¤ê°€ ì‚­ì œë¨
- í•´ê²°: ë¡œê·¸ì•„ì›ƒ í›„ ì¬ë¡œê·¸ì¸

**2. í”„ë¡œë•ì…˜ DB ë§ˆì´ê·¸ë ˆì´ì…˜ ë¯¸ì™„ë£Œ**
- `user_latitude`, `user_longitude`, `address` ì»¬ëŸ¼ ëˆ„ë½
- í•´ê²°: DB ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš© í•„ìš”

**3. API ì¸ì¦ ë¬¸ì œ**
- CORS ì„¤ì • ë˜ëŠ” ì¿ í‚¤ ì „ì†¡ ë¬¸ì œ
- í•´ê²°: `credentials: 'include'` ì˜µì…˜ ì¶”ê°€ (âœ… ì´ë¯¸ ì ìš©ë¨)

---

## âœ… í•´ê²° ë°©ë²•

### ë°©ë²• 1: ë¡œê·¸ì•„ì›ƒ í›„ ì¬ë¡œê·¸ì¸ (ê°€ì¥ ê°„ë‹¨)

**1. ë¡œê·¸ì•„ì›ƒ**
```
https://aromapulse.pages.dev/logout
ë˜ëŠ”
ë¸Œë¼ìš°ì € ì¿ í‚¤ ì‚­ì œ
```

**2. ì¬ë¡œê·¸ì¸**
```
https://aromapulse.pages.dev/auth/google
ë˜ëŠ”
https://aromapulse.pages.dev/auth/naver
```

**3. ë‹¤ì‹œ ì‹œë„**
```
https://aromapulse.pages.dev/static/healing
â†’ "ë‚´ ìœ„ì¹˜ë¡œ ê²€ìƒ‰" í´ë¦­
â†’ ì£¼ì†Œ ì…ë ¥
```

---

### ë°©ë²• 2: ë¸Œë¼ìš°ì € ìºì‹œ ë° ì¿ í‚¤ ì‚­ì œ

**Chrome/Edge:**
1. F12 (ê°œë°œì ë„êµ¬)
2. Application íƒ­
3. Cookies â†’ aromapulse.pages.dev
4. ëª¨ë“  ì¿ í‚¤ ì‚­ì œ
5. í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (Ctrl+F5)
6. ì¬ë¡œê·¸ì¸

**Firefox:**
1. F12
2. Storage íƒ­
3. Cookies â†’ aromapulse.pages.dev
4. ëª¨ë“  ì¿ í‚¤ ì‚­ì œ
5. í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ (Ctrl+Shift+R)
6. ì¬ë¡œê·¸ì¸

---

### ë°©ë²• 3: ì‹œí¬ë¦¿/í”„ë¼ì´ë¹— ëª¨ë“œ ì‚¬ìš©

**1. ì‹œí¬ë¦¿ ì°½ ì—´ê¸°**
- Chrome: Ctrl+Shift+N
- Firefox: Ctrl+Shift+P
- Edge: Ctrl+Shift+N

**2. ìƒˆë¡œ ë¡œê·¸ì¸**
```
https://aromapulse.pages.dev/auth/google
```

**3. ìœ„ì¹˜ ì„¤ì • ì‹œë„**
```
https://aromapulse.pages.dev/static/healing
```

---

## ğŸ§ª ë””ë²„ê¹… ë°©ë²•

### ë¸Œë¼ìš°ì € ì½˜ì†” í™•ì¸ (F12)

**1. Console íƒ­ì—ì„œ í™•ì¸í•  ë¡œê·¸:**
```javascript
[Update Location] Saving location: {...}
[Update Location] Response: {...}
```

**2. ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸:**
- `401 Unauthorized` â†’ ë¡œê·¸ì¸ í•„ìš”
- `500 Internal Server Error` â†’ ì„œë²„ ì˜¤ë¥˜ (DB ë¬¸ì œ)
- `403 Forbidden` â†’ ê¶Œí•œ ì—†ìŒ

**3. Network íƒ­ì—ì„œ í™•ì¸:**
- `/api/user/location` ìš”ì²­
- Request Headers â†’ Cookie í™•ì¸
- Response â†’ ì—ëŸ¬ ë©”ì‹œì§€ í™•ì¸

---

## ğŸ”§ í”„ë¡œë•ì…˜ DB ë§ˆì´ê·¸ë ˆì´ì…˜ (ê´€ë¦¬ììš©)

ë§Œì•½ í”„ë¡œë•ì…˜ DBì— `address` ì»¬ëŸ¼ì´ ì—†ë‹¤ë©´:

**Cloudflare Dashboardì—ì„œ ì‹¤í–‰:**

```sql
-- users í…Œì´ë¸”ì— address ì»¬ëŸ¼ ì¶”ê°€ (ì´ë¯¸ ìˆì„ ìˆ˜ ìˆìŒ)
ALTER TABLE users ADD COLUMN address TEXT;
```

**ë˜ëŠ” Wrangler CLIë¡œ ì‹¤í–‰:**

```bash
# Cloudflare API í‚¤ ì„¤ì • í•„ìš”
npx wrangler d1 execute aromapulse-production --remote --command="
SELECT name FROM pragma_table_info('users') WHERE name='address';
"

# address ì»¬ëŸ¼ì´ ì—†ìœ¼ë©´ ì¶”ê°€
npx wrangler d1 execute aromapulse-production --remote --command="
ALTER TABLE users ADD COLUMN address TEXT;
"
```

---

## âœ… ì •ìƒ ì‘ë™ í™•ì¸

**ì„±ê³µ ì‹œ í‘œì‹œë˜ëŠ” ë©”ì‹œì§€:**
```
âœ… ìœ„ì¹˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì„¤ì •ë˜ì—ˆìŠµë‹ˆë‹¤!

ğŸ“ ì¸ì²œ ê³„ì–‘êµ¬ ì‘ì „ë™ 863-17
ğŸ“ ìœ„ë„: 37.531153, ê²½ë„: 126.723647
```

**í™•ì¸ ì‚¬í•­:**
- âœ… ì•Œë¦¼ì°½ì— ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ
- âœ… ì§€ë„ê°€ í•´ë‹¹ ìœ„ì¹˜ë¡œ ì´ë™
- âœ… 50km ë‚´ ê³µë°© í•„í„°ë§ ì‘ë™
- âœ… ê°™ì€ ì§€ì—­ ê³µë°© í‘œì‹œ

---

## ğŸ’¡ ì¶”ê°€ íŒ

### GPS ìë™ ê°ì§€ ì‚¬ìš©
ì£¼ì†Œ ì…ë ¥ì´ ì–´ë µë‹¤ë©´ GPSë¥¼ ì‚¬ìš©í•˜ì„¸ìš”:

```
1. "ë‚´ ìœ„ì¹˜ë¡œ ê²€ìƒ‰" í´ë¦­
2. "í˜„ì¬ ìœ„ì¹˜ ìë™ ê°ì§€" ì„ íƒ
3. ìœ„ì¹˜ ê¶Œí•œ í—ˆìš©
4. âœ… ìë™ìœ¼ë¡œ ì¢Œí‘œ ì €ì¥
```

### ì €ì¥ëœ ì£¼ì†Œ ì¬ì‚¬ìš©
í•œ ë²ˆ ì €ì¥í•˜ë©´ ë‹¤ìŒë¶€í„°ëŠ”:

```
1. "ë‚´ ìœ„ì¹˜ë¡œ ê²€ìƒ‰" í´ë¦­
2. ëª¨ë‹¬ í•˜ë‹¨ì— "ì €ì¥ëœ ì£¼ì†Œ" í‘œì‹œ
3. "ì´ ì£¼ì†Œë¡œ ê²€ìƒ‰í•˜ê¸°" í´ë¦­
4. âœ… ì¦‰ì‹œ ì ìš©
```

---

## ğŸ“ ì—¬ì „íˆ í•´ê²°ë˜ì§€ ì•ŠëŠ”ë‹¤ë©´

**1. ìŠ¤í¬ë¦°ìƒ· ì¤€ë¹„:**
- ì—ëŸ¬ ë©”ì‹œì§€ ì•Œë¦¼ì°½
- ë¸Œë¼ìš°ì € ì½˜ì†” (F12)
- Network íƒ­ì˜ `/api/user/location` ìš”ì²­

**2. ë‹¤ìŒ ì •ë³´ í™•ì¸:**
- ì‚¬ìš©í•œ OAuth ì œê³µì (Google/Naver/Kakao)
- ë¸Œë¼ìš°ì € ì¢…ë¥˜ ë° ë²„ì „
- ì‹œë„í•œ ì£¼ì†Œ

**3. ì„ì‹œ í•´ê²°ì±…:**
- GPS ìë™ ê°ì§€ ì‚¬ìš©
- ë‹¤ë¥¸ ë¸Œë¼ìš°ì €ë¡œ ì‹œë„
- ë‹¤ë¥¸ ê¸°ê¸°ì—ì„œ ì‹œë„

---

## ğŸš€ ìµœì‹  ë°°í¬ ì •ë³´

**í”„ë¡œë•ì…˜ URL**: https://aromapulse.pages.dev  
**ìµœì‹  ë°°í¬**: https://19dc6b06.aromapulse.pages.dev  
**GitHub ì»¤ë°‹**: `945dddc` (2025-11-25 17:15 KST)

**ì ìš©ëœ ìˆ˜ì •ì‚¬í•­:**
- âœ… `credentials: 'include'` ì¶”ê°€
- âœ… ìƒì„¸í•œ ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ
- âœ… HTTP ìƒíƒœ ì½”ë“œ í‘œì‹œ
- âœ… ë¡œê·¸ì¸ í™•ì¸ íŒíŠ¸ ì¶”ê°€

---

## ğŸ“ ê´€ë ¨ API ì—”ë“œí¬ì¸íŠ¸

### ìœ„ì¹˜ ì—…ë°ì´íŠ¸ API
```
PUT /api/user/location

Headers:
  Content-Type: application/json
  Cookie: auth_token=...

Request Body:
{
  "latitude": 37.531153,
  "longitude": 126.723647,
  "address": "ì¸ì²œ ê³„ì–‘êµ¬ ì‘ì „ë™ 863-17"
}

Success Response (200):
{
  "message": "ìœ„ì¹˜ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤",
  "latitude": 37.531153,
  "longitude": 126.723647
}

Error Response (401):
{
  "error": "ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤",
  "autoLogout": true
}

Error Response (500):
{
  "error": "ìœ„ì¹˜ ì—…ë°ì´íŠ¸ ì‹¤íŒ¨",
  "details": "..."
}
```

### Geocoding API
```
GET /api/geocode/google?address={ì£¼ì†Œ}
GET /api/geocode/naver?address={ì£¼ì†Œ}
GET /api/geocode/kakao?address={ì£¼ì†Œ}

Success Response:
{
  "latitude": 37.531153,
  "longitude": 126.723647,
  "address": "ì¸ì²œ ê³„ì–‘êµ¬ ì‘ì „ë™ 863-17",
  "provider": "google"
}
```

---

**ê°€ì¥ ê°„ë‹¨í•œ í•´ê²°ì±…: ë¡œê·¸ì•„ì›ƒ â†’ ì¬ë¡œê·¸ì¸ â†’ ë‹¤ì‹œ ì‹œë„** âœ¨
